<?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated from tcl/help/en/CQL-Position-List.txt -->

<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<head>
  <meta http-equiv="content-type"
           content="text/html; charset=utf-8" />
  <meta http-equiv="content-language"
           content="en" />
  <meta http-equiv="content-style-type"
           content="text/css" />

  <meta name="generator"
     content="scidb.sourceforge.net" />
  <meta name="description"
     content="Scidb Help Page" />

  <link rel="icon"
       href="http://scidb.sourceforge.net/images/scidb.ico"
       type="image/x-icon" />
  <link rel="shortcut icon"
       href="http://scidb.sourceforge.net/images/scidb.ico" />
  <link rel="stylesheet"
       type="text/css"
      media="screen"
       href="../styles/help.css" />

  <title>Help: CQL - The position list</title>
</head>

<body>

<div class="title">
  <h1 class="title">CQL - The position list</h1>
</div>

<ul style="list-style-type: none"><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#index">Index</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#logical">Logical keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#simple">Simple keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#transform">Transformation keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#piece">Piece configuration keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#move">Move keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#sequence">Logical keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#game">Game related keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#relation">Relation between positions</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#matching">Matching count keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#accumulator">Accumulator keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#tagging">Tagging keywords</a></td></tr>
  </table>
</li></ul>

<h2 id="index">Index</h2>

<ul style="list-style-type: none"><li>
  <table>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:accumulate">:accumulate</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:losing">:losing</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:raydiagonal">:raydiagonal</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:and">:and</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:markall">:markall</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:rayhorizontal">:rayhorizontal</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:attackcount">:attackcount</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:matchcount">:matchcount</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:rayorthogonal">:rayorthogonal</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:blackelo">:blackelo</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:mate">:mate</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:rayvertical">:rayvertical</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:blackrating">:blackrating</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:maxswapvalue">:maxswapvalue</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:ray">:ray</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:btm">:btm</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:movefrom">:movefrom</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:repetition">:repetition</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:castling">:castling</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:movenumber">:movenumber</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:relation">:relation</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:checkcount">:checkcount</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:moveto">:moveto</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:reset">:reset</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:check">:check</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:noannotate">:noannotate</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:result">:result</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:contactcheck">:contactcheck</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:nocastling">:nocastling</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:sequence">:sequence</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:doublecheck">:doublecheck</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nocheck">:nocheck</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:shift">:shift</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:elo">:elo</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nocontactcheck">:nocontactcheck</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:shiftdiagonal">:shiftdiagonal</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:endgame">:endgame</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nodoublecheck">:nodoublecheck</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:shifthorizontal">:shifthorizontal</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:enpassant">:enpassant</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:noendgame">:noendgame</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:shiftmaindiagonal">:shiftmaindiagonal</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:fen">:fen</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:noenpassant">:noenpassant</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:shiftoffdiagonal">:shiftoffdiagonal</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:fiftymoverule">:fiftymoverule</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nostalemate">:nostalemate</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:shiftvertical">:shiftvertical</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:flipcolor">:flipcolor</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:not">:not</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:stalemate">:stalemate</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:flipdiagonal">:flipdiagonal</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:or">:or</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:sumrange">:sumrange</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:flipdihedral">:flipdihedral</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:piececount">:piececount</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:tagmatch">:tagmatch</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:fliphorizontal">:fliphorizontal</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:piecedrop">:piecedrop</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:terminal">:terminal</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:flipvertical">:flipvertical</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:power">:power</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:variationsonly">:variationsonly</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:flip">:flip</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:powerdifference">:powerdifference</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:variations">:variations</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:gappedsequence">:gappedsequence</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:pretransformmatchcount">:pretransformmatchcount</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:whiteelo">:whiteelo</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:initial">:initial</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:promote">:promote</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:whiterating">:whiterating</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:inside">:inside</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:rating">:rating</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:wtm">:wtm</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:iscastling">:iscastling</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:rayattack">:rayattack</a></td>
      <td></td><td></td>
    </tr>
  </table>
</li></ul>

<h2 id="logical">Logical keywords</h2>

<ul style="list-style-type: none"><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:and">:and</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:not">:not</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:or">:or</a></td></tr>
  </table>
</li></ul>

<h3 id="position:and">:and</h3>

<p>
Takes a list of position lists and matches a position only if each of them
match the position.
</p>

<p>
Example:
</p>

<div class="box"><pre><code><!--
-->(position 
  <a href="CQL-Position-List.html#position:wtm">:wtm</a>
  <a href="CQL-Position-List.html#position:check">:check</a>
  <span class="keyword">:and</span> (
    (position <span class="chess">&#x2654;</span>e2 <span class="chess">&#x265a;</span>g2 <a href="CQL-Position-List.html#position:shift">:shift</a> <a href="CQL-Position-List.html#position:flip">:flip</a>)
    (position <span class="chess">&#x2658;</span>e2)))<!--
--></code></pre></div>

<p>
Matches positions in which the kings are in opposition, there is a white knight
on e2, and white is in check.
</p>

<h3 id="position:not">:not</h3>

<p>
This keyword can be used in two forms: either it is included in a position
match list, or it has a sub-position list as argument. In former case:
match if the containing match list would not match without the :not. In
latter case negate the result of the sub-position list match. The former
case is conform with CQL standard of keyword <a href="CQL-Position-List.html#position:not">:not</a>,
the second form is an extension.
</p>

<p>
Examples:
</p>

<div class="box"><pre><code><!--
-->(match
  (position
    ; <span class="comment">we are searching for both colors</span>
    <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>
    <span class="comment">; the mating position must match each criterion below</span>
    <a href="CQL-Position-List.html#position:and">:and</a> (
      <span class="comment">; the black king is surrounded by empty squares and</span>
      <span class="comment">; is attacked once and is in mate</span>
      (position
        <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> <span class="chess">&#x265a;</span> . 8
        <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> A <span class="chess">&#x265a;</span> 1
        <a href="CQL-Position-List.html#position:mate">:mate</a>
        <a href="CQL-Position-List.html#position:btm">:btm</a>)
      <span class="comment">; check that no neighbor of the black king is</span>
      <span class="comment">; attacked more than once</span>
      (position
        <span class="keyword">:not</span>
        <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> <span class="chess">&#x265a;</span> .e4 1
        <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> A .e4 2 100
        <a href="CQL-Position-List.html#position:shift">:shift</a>))))<!--
--></code></pre></div>

<p>
This finds all mating positions in which the king is surrounded by empty squares.
</p>

<p>
The follwing position match
</p>

<div class="verb"><code>
(position <span class="chess">&#x2656;</span>a3 <span class="keyword">:not</span>)
</code></div>

<p>
is equivalent to
</p>

<div class="verb"><code>
(position [a<span class="chess">&#x2655;</span><span class="chess">&#x2657;</span><span class="chess">&#x2658;</span><span class="chess">&#x2659;</span><span class="chess">&#x2654;</span>.]a3)
</code></div>

<h3 id="position:or">:or</h3>

<p>
Takes a list of position lists and matches a position only if at least one of them matches the position.
</p>

<p>
Example:
</p>

<div class="box"><pre><code><!--
-->(match
  (position
    <span class="keyword">:or</span> (
      (position <a href="CQL-Position-List.html#position:piececount">:piececount</a>
        <span class="chess">&#x2657;</span>[a1,a3,a5,a7,b2,b4,b6,b8,c1,c3,c5,c7,d2,d4,d6,d8,e1,
        e3,e5,e7,f2,f4,f6,f8,g1,g3,g5,g7,h2,h4,h6,h8] 2 9 )
      (position <a href="CQL-Position-List.html#position:piececount">:piececount</a>
        <span class="chess">&#x265d;</span>[a1,a3,a5,a7,b2,b4,b6,b8,c1,c3,c5,c7,d2,d4,d6,d8,e1,
        e3,e5,e7,f2,f4,f6,f8,g1,g3,g5,g7,h2,h4,h6,h8] 2 9)
      (position <a href="CQL-Position-List.html#position:piececount">:piececount</a>
        <span class="chess">&#x265d;</span>[a2,a4,a6,a8,b1,b3,b5,b7,c2,c4,c6,c8,d1,d3,d5,d7,e2,
        e4,e6,e8,f1,f3,f5,f7,g2,g4,g6,g8,h1,h3,h5,h7] 2 9)
      (position <a href="CQL-Position-List.html#position:piececount">:piececount</a>
        <span class="chess">&#x2657;</span>[a2,a4,a6,a8,b1,b3,b5,b7,c2,c4,c6,c8,d1,d3,d5,d7,e2,
        e4,e6,e8,f1,f3,f5,f7,g2,g4,g6,g8,h1,h3,h5,h7] 2 9))))<!--
--></code></pre></div>

<p>
Searching for games with that have either two light-squared white
bishops, two dark-squared white bishops, two dark-square black
bishops. or two light-square black bishops.
</p>

<h2 id="simple">Simple keywords</h2>

<ul style="list-style-type: none"><li>
  <table>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:btm">:btm</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:noannotate">:noannotate</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:castling">:castling</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nocheck">:nocheck</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:check">:check</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nocontactcheck">:nocontactcheck</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:checkcount">:checkcount</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nodoublecheck">:nodoublecheck</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:contactcheck">:contactcheck</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:noendgame">:noendgame</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:doublecheck">:doublecheck</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nostalemate">:nostalemate</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:endgame">:endgame</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:repetition">:repetition</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:fen">:fen</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:stalemate">:stalemate</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:fiftymoverule">:fiftymoverule</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:terminal">:terminal</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:initial">:initial</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:variations">:variations</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:losing">:losing</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:variationsonly">:variationsonly</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:markall">:markall</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:wtm">:wtm</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:mate">:mate</a></td>
    </tr>
  </table>
</li></ul>

<h3 id="position:btm">:btm</h3>

<p>
Match only if black is to move.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:wtm">:wtm</a>.
</p>

<h3 id="position:check">:check</h3>

<p>
One side is in check.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:nocheck">:nocheck</a>, <a href="CQL-Position-List.html#position:doublecheck">:doublecheck</a>,
<a href="CQL-Position-List.html#position:nodoublecheck">:nodoublecheck</a>, <a href="CQL-Position-List.html#position:contactcheck">:contactcheck</a>,
<a href="CQL-Position-List.html#position:nocontactcheck">:nocontactcheck</a>.
</p>

<h3 id="position:checkcount">:checkcount</h3>

<p>
If the parameter is a single number (between 0 and 3 is allowed), it is
matching all positions where last move is giving n-th check to other side.
</p>

<p>
If the parameter has the form <span style="white-space:nowrap;"><code>+&lt;n&#x2081;&gt;+&lt;n&#x2082;&gt;</code></span>,
where <span style="white-space:nowrap;"><code>&lt;n&#x2093;&gt;</code></span> is a number between 0 and 3,
it is matching all positions where white has given n&#x2081;-th check
to black, and black has given n&#x2082;-th check to white.
<p>

<p><img src="../images/note.png" alt="note" /> 
This search is working only in chess variant Three-check Chess,
it is ignored in other chess variants.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<p>
Examples:
</p>

<div class="verb"><code>
(position <span class="keyword">:checkcount</span> 2)
</code></div>

<p>
Match if any side has given second check.
</p>

<div class="verb"><code>
(position <span class="keyword">:checkcount</span> +0+3)
</code></div>

<p>
Match if black has given third check to white. This must be a final position.
</p>

<div class="verb"><code>
(position <a href="CQL-Position-List.html#position:not">:not</a> <span class="keyword">:checkcount</span> +0+0)
</code></div>

<p>
This is in fact a useful match. Assume that a game is starting with the
following position (described with <a href="FEN.html">FEN</a>):
</p>

<ul style="list-style-type: none"><li><code>
rnb1k1nr/pppp1ppp/8/4p3/3PP2q/2N5/PP3PPP/R1BQKBNR w KQkq - 1 5 +0+2
</code></li></ul>

<p>
This game would match (note keyword :not), because black has already
given second check to white in first position of the game. With other
words, this example is searching for games starting with an advanced
position, where one side has already given a check.
</p>

<h3 id="position:castling">:castling</h3>

<p>
This keyword specifies castling availabilities for both sides. It takes as an
argument a piecetype designator, letters of which have the following meanings:
</p>

<ul style="list-style-type: none"><li>
  <table>
    <tr>
      <td class="l"><span style="white-space:nowrap;"><code><span class="chess">&#x2654;</span></code></span></td>
      <td class="r">White has kingside castling availability</td>
    </tr>
    <tr>
      <td class="l"><span style="white-space:nowrap;"><code><span class="chess">&#x2655;</span></code></span></td>
      <td class="r">White has queenside castling availability</td>
    </tr>
    <tr>
      <td class="l"><span style="white-space:nowrap;"><code><span class="chess">&#x265a;</span></code></span></td>
      <td class="r">Black has kingside castling availability</td>
    </tr>
    <tr>
      <td class="l"><span style="white-space:nowrap;"><code><span class="chess">&#x265b;</span></code></span></td>
      <td class="r">Black has queenside castling availability</td>
    </tr>
  </table>
</li></ul>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>
<p><img src="../images/note.png" alt="note" /> This keyword is borrowed from Chess Assistant 9 (&#x21d2; <a href="http://hornid.com/chess/docs/CQL-3GX.pdf">The CQL 3.GX Extension<span class="awesome"/>&nbsp;&#xf08e;</span></a>).

<p>
Examples:
</p>

<div class="verb"><code>
(position <span class="keyword">:castling</span> <span class="chess">&#x2654;</span>)
</code></div>

<p>
White has kingside castling availability.
</p>

<div class="verb"><code>
(position <span class="keyword">:castling</span> [<span class="chess">&#x2654;</span><span class="chess">&#x2655;</span>])
</code></div>

<p>
White has either kingside or queenside castling availability.
</p>

<div class="verb"><code>
(position <span class="keyword">:castling</span> <span class="chess">&#x2654;</span> <span class="keyword">:castling</span> <span class="chess">&#x2655;</span>)
</code></div>

<p>
White has both kingside and queenside castling availabilities.
</p>

<h3 id="position:contactcheck">:contactcheck</h3>

<p>
One side is in check, and it is a contact check.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<p>
See also: <a href="CQL-Position-List.html#position:check">:check</a>, <a href="CQL-Position-List.html#position:nocheck">:nocheck</a>,
<a href="CQL-Position-List.html#position:doublecheck">:doublecheck</a>, <a href="CQL-Position-List.html#position:nodoublecheck">:nodoublecheck</a>,
<a href="CQL-Position-List.html#position:nocontactcheck">:nocontactcheck</a>.
</p>

<h3 id="position:doublecheck">:doublecheck</h3>

<p>
One side is in check, and it is a double check.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<p>
See also: <a href="CQL-Position-List.html#position:check">:check</a>, <a href="CQL-Position-List.html#position:nocheck">:nocheck</a>,
<a href="CQL-Position-List.html#position:nodoublecheck">:nodoublecheck</a>, <a href="CQL-Position-List.html#position:contactcheck">:contactcheck</a>,
<a href="CQL-Position-List.html#position:nocontactcheck">:nocontactcheck</a>.
</p>

<h3 id="position:endgame">:endgame</h3>

<p>
The position is an endgame position. The keyword is equivalent to the following
query:
</p>

<div class="box"><pre><code><!--
-->  (position
    <a href="CQL-Position-List.html#position:or">:or</a> (
      (position
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] 0
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class="chess">&#x2656;</span><span class="chess">&#x2657;</span><span class="chess">&#x2658;</span>] 0 3
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class="chess">&#x265c;</span><span class="chess">&#x265d;</span><span class="chess">&#x265e;</span>] 0 3)
    (position
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class="chess">&#x2655;</span> 1
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class="chess">&#x265b;</span> 1
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class="chess">&#x2656;</span><span class="chess">&#x265c;</span>] 0
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> I 0 1
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> i 0 1)
    (position
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class="chess">&#x2655;</span> 1
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class="chess">&#x2656;</span> 0
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> I 0 1
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class="chess">&#x265b;</span> 0
      <a href="CQL-Position-List.html#position:power">:power</a> [rbn] 0 16
      <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>)))<!--
--></code></pre></div>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>
<p><img src="../images/note.png" alt="note" /> This keyword is borrowed from Chess Assistant 9 (&#x21d2; <a href="http://hornid.com/chess/docs/CQL-3GX.pdf">The CQL 3.GX Extension<span class="awesome"/>&nbsp;&#xf08e;</span></a>).

<p>
See also: <a href="CQL-Position-List.html#position:noendgame">:noendgame</a>.
</p>

<h3 id="position:fen">:fen</h3>

<p>
The position is equal to the described position in given
<a href="FEN.html">FEN</a>.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<h3 id="position:fiftymoverule">:fiftymoverule</h3>

<p>
First position in game where no capture has been made and no pawn has been
moved in previous fifty consecutive moves.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<h3 id="position:initial">:initial</h3>

<p>
This is the first position in the game.
</p>

<h3 id="position:losing">:losing</h3>

<p>
Matches the final position if one side has lost all pieces.
This is possible only in Antichess games.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<h3 id="position:markall">:markall</h3>

<p>
This keyword is supported to be compatible with CQL standard, and does
not have any meaning in Scidb.
</p>

<h3 id="position:mate">:mate</h3>

<p>
Match only if the position is a mate.
</p>

<p>
Example:
</p>

<div class="verb"><code>
(position <span class="keyword">:mate</span> <a href="CQL-Position-List.html#position:movenumber">:movenumber</a> 1 20)
</code></div>

<p>
Only matches if one side is mated in first 20 moves.
</p>

<h3 id="position:noannotate">:noannotate</h3>

<p>
This keyword is supported to be compatible with CQL standard, and does
not have any meaning in Scidb.
</p>

<h3 id="position:nocheck">:nocheck</h3>

<p>
Neither side is in check.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:check">:check</a>, <a href="CQL-Position-List.html#position:doublecheck">:doublecheck</a>,
<a href="CQL-Position-List.html#position:nodoublecheck">:nodoublecheck</a>, <a href="CQL-Position-List.html#position:contactcheck">:contactcheck</a>,
<a href="CQL-Position-List.html#position:nocontactcheck">:nocontactcheck</a>.
</p>

<h3 id="position:nocontactcheck">:nocontactcheck</h3>

<p>
Neither side is in check, or it is not a contact check.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<p>
See also: <a href="CQL-Position-List.html#position:check">:check</a>, <a href="CQL-Position-List.html#position:nocheck">:nocheck</a>,
<a href="CQL-Position-List.html#position:doublecheck">:doublecheck</a>, <a href="CQL-Position-List.html#position:nodoublecheck">:nodoublecheck</a>,
<a href="CQL-Position-List.html#position:contactcheck">:contactcheck</a>.
</p>

<h3 id="position:nodoublecheck">:nodoublecheck</h3>

<p>
Neither side is in check, or it is not a double check.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<h3 id="position:noendgame">:noendgame</h3>

<p>
The position is not an endgame position (&#x21d2;
<a href="CQL-Position-List.html#position:noendgame">:noendgame</a>).
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<h3 id="position:nostalemate">:nostalemate</h3>

<p>
Match only if the position is not a stalemate.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<p>
See also: <a href="CQL-Position-List.html#position:stalemate">:stalemate</a>,
</p>

<h3 id="position:repetition">:repetition</h3>

<p>
Matches positions which occurred the third time in this game.
The repeated positions need not occur in succession. This accords
with the <a href="http://en.wikipedia.org/wiki/Threefold_repetition">
threefold repetition rule<span class="awesome"/>&nbsp;&#xf08e;</span></a>.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<h3 id="position:stalemate">:stalemate</h3>

<p>
Match only if the position is a stalemate.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:nostalemate">:nostalemate</a>,
</p>

<h3 id="position:terminal">:terminal</h3>

<p>
This is the last position in the game.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<h3 id="position:variations">:variations</h3>

<p>
Look in the variations to find matches.
</p>

<h3 id="position:variationsonly">:variationsonly</h3>

<p>
Look only in the variations to find matches, not in the main line.
</p>

<h3 id="position:wtm">:wtm</h3>

<p>
Match only if white is to move.
</p>

<h2 id="transform">Transformation keywords</h2>

<ul style="list-style-type: none"><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:flip">:flip</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:flipcolor">:flipcolor</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:flipdiagonal">:flipdiagonal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:flipdihedral">:flipdihedral</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:fliphorizontal">:fliphorizontal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:flipvertical">:flipvertical</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:inside">:inside</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:shift">:shift</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:shiftdiagonal">:shiftdiagonal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:shifthorizontal">:shifthorizontal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:shifthorizontal*">:shifthorizontal*</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:shiftmaindiagonal">:shiftmaindiagonal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:shiftoffdiagonal">:shiftoffdiagonal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:shiftvertical">:shiftvertical</a></td></tr>
  </table>
</li></ul>

<h3 id="position:flip">:flip</h3>

<p>
Same as <a href="CQL-Position-List.html#position:flipdihedral">:flipdihedral</a> (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:flipcolor">:flipcolor</h3>

<p>
The color flip transformation (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:flipdiagonal">:flipdiagonal</h3>

<p>
The diagonal flip transformation (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:flipdihedral">:flipdihedral</h3>

<p>
All dihedral transformations (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:fliphorizontal">:fliphorizontal</h3>

<p>
The horizontal flip transformation (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:flipvertical">:flipvertical</h3>

<p>
The vertical flip transformation (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:inside">:inside</h3>

<p>
This keyword filters shift transformations in order to some matching pieces
will stay inside a specified region of the board. It takes two arguments, a
piece designator and a square designator. Any shift transformation affects
only the first argument. A shift transformation match :inside limitation if
at least one piece matching the first argument (taking into account the
transformation) is placed on a square matching the second argument.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>
<p><img src="../images/note.png" alt="note" /> This keyword is borrowed from Chess Assistant 9 (&#x21d2; <a href="http://hornid.com/chess/docs/CQL-3GX.pdf">The CQL 3.GX Extension<span class="awesome"/>&nbsp;&#xf08e;</span></a>).

<p>
Example:
</p>

<p>
We use the following query to find tripled pawns:
</p>

<div class="box"><pre><code><!--
-->(position
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class="chess">&#x2659;</span>[b2-7] 3
  <a href="CQL-Position-List.html#position:shifthorizontal">:shifthorizontal</a>)<!--
--></code></pre></div>

<p>
To find one of tripled pawns placed on the main diagonal we design the query
</p>

<div class="box"><pre><code><!--
-->(position
  <span class="keyword">:inside</span> <span class="chess">&#x2659;</span>[b2-7] [b2,c3,d4,e5,f6,g7]
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class="chess">&#x2659;</span>[b2-7] 3
  <a href="CQL-Position-List.html#position:shifthorizontal">:shifthorizontal</a>)<!--
--></code></pre></div>

<h3 id="position:shift">:shift</h3>

<p>
The shift transformations (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:shiftdiagonal">:shiftdiagonal</h3>

<p>
The off-diagonal and main-diagonal shift transformations (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:shifthorizontal">:shifthorizontal</h3>

<p>
The horizontal shift transformations (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:shiftmaindiagonal">:shiftmaindiagonal</h3>

<p>
The main-diagonal shift transformations (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:shiftoffdiagonal">:shiftoffdiagonal</h3>

<p>
The off-diagonal shift transformations. (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:shiftvertical">:shiftvertical</h3>

<p>
The vertical shift transformations (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h2 id="piece">Piece configuration keywords</h2>

<ul style="list-style-type: none"><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:attackcount">:attackcount</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:maxswapvalue">:maxswapvalue</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:piececount">:piececount</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:power">:power</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:powerdifference">:powerdifference</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:ray">:ray</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:rayattack">:rayattack</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:raydiagonal">:raydiagonal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:rayhorizontal">:rayhorizontal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:rayorthogonal">:rayorthogonal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:rayvertical">:rayvertical</a></td></tr>
  </table>
</li></ul>

<h3 id="position:attackcount">:attackcount</h3>

<p>
This keyword takes as arguments two piece designators followed by a range
specifier. The first piece designator is the attacker piece designator.
The second piece designator is the attacked piece designator. An attack by
a piece to a square occurs if the piece could move to that square were it
empty and disregarding any possible checks. A valid attack is an attack by
a piece on a square that matches the attacker piece designator to a square
on which is a piece that matches the attacking piece designator.
</p>

<p>
The :attackcount keyword matches a position if the total number
of valid attacks in the position lies with the range given by its range
specifier.
</p>

<p>
Examples:
</p>

<div class="verb"><code>
(position <span class="keyword">:attackcount</span> A <span class="chess">&#x265a;</span> 2)
</code></div>

<p>
Matches any position in which white has a double attack on the black king.
</p>

<div class="verb"><code>
(position <span class="keyword">:attackcount</span> A <span class="chess">&#x265a;</span> 2 <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>)
</code></div>

<p>
Matches any position in which a king is under double attack.
</p>

<div class="verb"><code>
(position <span class="keyword">:attackcount</span> A .h3 1)
</code></div>

<p>
Matches a position in which exactly one white piece attacks an empty h3 square.
</p>

<div class="verb"><code>
(position <span class="keyword">:attackcount</span> [<span class="chess">&#x2656;</span><span class="chess">&#x2657;</span>][a-c8] ??1 5 9
</code></div>

<p>
Matches a position in which the number of times a white rook or white bishop
on a8, b8, or c8 attacks a square on the first rank is between 5 and 9
inclusive.
</p>

<div class="verb"><code>
(position <span class="keyword">:attackcount</span> <span class="chess">&#x265e;</span> [<span class="chess">&#x2654;</span><span class="chess">&#x2656;</span><span class="chess">&#x2655;</span>] 3 100) 
</code></div>

<p>
Matches position for which the number of times a black knight attacks a white
King or white major piece is at least 3.
</p>

<h3 id="position:maxswapvalue">:maxswapvalue</h3>

<p>
This keyword allows to estimate exchange values of possible moves. It takes
as arguments two piece designators followed by a range specifier. The first
argument specifies moving pieces, the second one specifies target squares.
For each possible moves we compute an integer value that is a material benefit
of the move (in pawns, like in case of the <a href="CQL-Position-List.html#position:power">:power</a> keyword)
according to possible piece exchanges on the target square after the move.
After that we
select the maximum of all computed values.
</p>

<p>
The keyword match the position if this value lies in the specified range. The
exchange function is taking into account that exchanged pieces may be pinned
or defended by other pieces. The value of the function depends on which side
is to move.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<p><img src="../images/note.png" alt="note" /> This keyword is borrowed from Chess Assistant 9 (&#x21d2;
<a href="http://hornid.com/chess/docs/CQL-3GX.pdf">The CQL 3.GX Extension<span class="awesome"/>&nbsp;&#xf08e;</span></a>),
but implemented in a different way, so it is not conform to the
implementation of Chess Assistant.
</p>

<p>
Examples:
</p>

<p>
The following query selects positions in which white threatens with
winning some material:
</p>

<div class="verb"><code>
(position <span class="keyword">:maxswapvalue</span> A a 1 1000)
</code></div>

<p>
The following query selects positions in which a white queen can invade rank 8
without a material loss.
</p>

<div class="verb"><code>
(position <span class="keyword">:maxswapvalue</span> <span class="chess">&#x2655;</span>?1-7 ??8 0 1000)
</code></div>

<h3 id="position:piececount">:piececount</h3>

<p>
This keyword takes a piece designator argument followed by a range specifier.
It matches the position if and only if the number of occurrences of the piece
designator in the position is given by the range specifier.
</p>

<p>
Examples:
</p>

<div class="verb"><code>
(position <span class="keyword">:piececount</span> <span class="chess">&#x2656;</span> 2)
</code></div>

<p>
This will match any position with exactly two white rooks - a position with
three white rooks would fail to match.
</p>

<div class="box"><pre><code><!--
-->(position 
  <span class="keyword">:piececount</span> [<span class="chess">&#x2656;</span><span class="chess">&#x265c;</span>][a1-8] 1 3 
  <span class="keyword">:piececount</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>][a-h8] 4 
  <span class="chess">&#x2658;</span>d4)<!--
--></code></pre></div>

<p>
This will match any position with a white knight on d4, between one and three
rooks on the a file, and exactly four queens on the eight rank. Another way
to write this position list is:
</p>

<div class="box"><pre><code><!--
-->(position 
  <span class="chess">&#x2658;</span>d4
  <span class="keyword">:piececount</span> [<span class="chess">&#x2656;</span><span class="chess">&#x265c;</span>][a?] 1 3 
  <span class="keyword">:piececount</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>][?8] 4)<!--
--></code></pre></div>

<h3 id="position:power">:power</h3>

<p>
This keyword takes as argument a piece designator followed by a range
specifier. It matches positions for which the total power of all pieces
in the position matching the piece designator lies within the range specifier.
The power of a piece is their chess material power, depending on the chess
variant:
</p>

<ul style="list-style-type: none"><li>
  <table cellpadding="3px">
    <tr>
      <td align="right"></td>
      <td align="right"><span class="chess">&#x2654;</span></td>
      <td align="right"><span class="chess">&#x2655;</span></td>
      <td align="right"><span class="chess">&#x2656;</span></td>
      <td align="right"><span class="chess">&#x2657;</span></td>
      <td align="right"><span class="chess">&#x2658;</span></td>
      <td align="right"><span class="chess">&#x2659;</span></td>
    </tr>
    <tr>
      <td>Normal Chess, Three-check Chess</td>
      <td align="right"> 0</td>
      <td align="right"> 9</td>
      <td align="right"> 5</td>
      <td align="right"> 3</td>
      <td align="right"> 3</td>
      <td align="right"> 1</td>
    </tr>
      <td>Crazyhouse Chess, Bughouse Chess</td>
      <td align="right"> 0</td>
      <td align="right"> 5</td>
      <td align="right"> 3</td>
      <td align="right"> 3</td>
      <td align="right"> 3</td>
      <td align="right"> 1</td>
    </tr>
    <tr>
      <td>Losers</td>
      <td align="right"> 0</td>
      <td align="right"> 5</td>
      <td align="right"> 4</td>
      <td align="right"> 3</td>
      <td align="right"> 4</td>
      <td align="right"> 1</td>
    </tr>
    <tr>
      <td>Suicide, Giveaway</td>
      <td align="right">30</td>
      <td align="right"> 3</td>
      <td align="right"> 9</td>
      <td align="right"> 0</td>
      <td align="right"> 9</td>
      <td align="right"> 1</td>
    </tr>
  </table>
</li></ul>

<p>
Examples:
</p>

<div class="verb"><code>
(position <span class="keyword">:power</span> a 6)
</code></div>

<p>
This will match positions in which the total power of the black pieces on the
board equals 6.
</p>

<div class="verb"><code>
(position <span class="keyword">:power</span> Aa-h1-4 10 25)
</code></div>

<p>
This will match positions in which the total power of the white pieces on the
white half of the board is between 10 and 25 inclusive.
</p>

<h3 id="position:powerdifference">:powerdifference</h3>

<p>
This keyword takes as argument a piece designator followed by a range
specifier. It matches positions in which the difference in power (&#x21d2;
<a href="CQL-Position-List.html#position:power">:power</a>) between the white and black pieces matching the
piece designator (that is, the numeric value of the power of the matching
black pieces subtracted from the power of the matching white pieces) lies
within the range specifier.
</p>

<p>
Examples:
</p>

<div class="verb"><code>
(position <span class="keyword">:powerdifference</span> U 4)
</code></div>

<p>
This matches positions in which the white pieces have power precisely 4
greater than the black pieces.
</p>

<div class="verb"><code>
(position <span class="keyword">:powerdifference</span> [<span class="chess">&#x2656;</span><span class="chess">&#x265c;</span>] -5 10)
</code></div>

<p>
This matches positions in which white has between one fewer and two more
rooks than black.
</p>

<div class="verb"><code>
(position <span class="keyword">:powerdifference</span> [<span class="chess">&#x2656;</span><span class="chess">&#x265c;</span><span class="chess">&#x2657;</span><span class="chess">&#x265d;</span><span class="chess">&#x2658;</span><span class="chess">&#x265e;</span>] -1000 -2)
</code></div>

<p>
This matches positions in which black is up at least an exchange.
</p>

<div class="box"><pre><code><!--
-->(match
  (position
    <a href="CQL-Match-List.html#match:result">:result</a> 1-0
    <a href="CQL-Position-List.html#position:sequence">:sequence</a> (
      (position
        <span class="keyword">:powerdifference</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] -1000 -9
        <span class="keyword">:powerdifference</span> U -1000 -9)
      (position <span class="keyword">:powerdifference</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] -1000 -9)
      (position <span class="keyword">:powerdifference</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] -1000 -9)
      (position <span class="keyword">:powerdifference</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] -1000 -9)
      (position <span class="keyword">:powerdifference</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] -1000 -9)
      (position <span class="keyword">:powerdifference</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] -1000 -9)
      (position <span class="keyword">:powerdifference</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] -1000 -9)
      (position <span class="keyword">:powerdifference</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] -1000 -9)
      (position <span class="keyword">:powerdifference</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] -1000 -9)
      (position <span class="keyword">:powerdifference</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] -1000 -9)
      (position <span class="keyword">:powerdifference</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] -1000 -9)
      (position <span class="keyword">:powerdifference</span> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] -1000 -9))
    <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>))<!--
--></code></pre></div>

<p>
This example shows how to search for queen sacrifices using
<code>:powerdifference</code>.
</p>

<h3 id="position:ray">:ray</h3>

<p>
A ray specifier is a list of piece designators. A ray is a contiguous set of
squares on a straight line on the chessboard parallel to an axis, the a1-h1
diagonal, or the a8-h8 diagonal.
</p>

<p>
Let R by a ray with ordered set of squares in a contiguous line
S&#x2081;, S&#x2082;,...,S&#x2090;. Suppose spec is a ray specifier
(G&#x2081;, G&#x2082;,...,G&#x2093;) where each G&#x2081;,...,G&#x2093;
is a piece designator. The ray R is valid with respect to the ray specifier
if G&#x2081; matches the piece on S&#x2081;, and if G&#x2093; matches the
piece on S&#x2090;, and if the remaining G's can be paired to some subset
of the squares in the ray in an order-preserving way such that each G matches
the piece on its corresponding square and such that all unpaired squares in
the ray are empty.
</p>

<p>
The :ray keyword takes a ray specifier and an optional range
specifier. If the range specifier is absent, it is taken to be 1 1000.
Otherwise, :ray matches a position if the number of rays in the
position valid with respect to the ray specifier lies within the range
specifier.
</p>

<p>
Examples:
</p>

<div class="verb"><code>
(position <span class="keyword">:ray</span> (<span class="chess">&#x265a;</span> <span class="chess">&#x2655;</span>)) 
</code></div>

<p>
Matches a position in which a white queen attacks the black king.
</p>

<div class="verb"><code>
(position <span class="keyword">:ray</span> (<span class="chess">&#x2655;</span>a? <span class="chess">&#x265e;</span> <span class="chess">&#x265a;</span>[?4-8]))
</code></div>

<p>
Matches a position in which a white queen on the a file pins a black knight
to the black king on the last four ranks.
</p>

<div class="verb"><code>
(position <span class="keyword">:ray</span> (<span class="chess">&#x2655;</span>a? <span class="chess">&#x2655;</span>c? <span class="chess">&#x2655;</span>e? <span class="chess">&#x265a;</span>g?))
</code></div>

<p>
Matches a position in which either three queens and the black king are on the
same rank, with exactly one empty square between them, and one of the queens
is on the a-file, or a position in which the three queens and king form a
diagonal with one empty squares between successive pieces and the queens on
the a, c, and e files.
</p>

<div class="verb"><code>
(position <span class="keyword">:ray</span> (<span class="chess">&#x2655;</span> <span class="chess">&#x265e;</span> <span class="chess">&#x265a;</span>) 2 4)
</code></div>

<p>
Between two and for black knights are pinned to the black king.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:rayattack">:rayattack</a>.
</p>

<h3 id="position:rayattack">:rayattack</h3>

<p>
Has the same syntax as <a href="CQL-Position-List.html#position:ray">:ray</a>. It has the semantics of
<a href="CQL-Position-List.html#position:ray">:ray</a>, except that only orthogonal rays that start on
a square containing a rook or queen are included, and only diagonal rays
starting on a square containing a bishop or queen are included.
</p>

<p>
Examples:
</p>

<div class="verb"><code>
(position <span class="keyword">:rayattack</span> (A a <span class="chess">&#x265a;</span>))
</code></div>

<p>
Matches a position in which a black piece is pinned to the black king.
</p>

<div class="verb"><code>
(position <span class="keyword">:rayattack</span> (Ad5 a [<span class="chess">&#x265c;</span><span class="chess">&#x265a;</span>][a-h1-4]) 3)
</code></div>

<p>
Matches positions in which there are three black pinned by a white piece on
d5 against either a black rook or king in the first four ranks.
</p>

<div class="verb"><code>
(position <a href="CQL-Position-List.html#position:stalemate">:stalemate</a> <span class="keyword">:rayattack</span>
(A a <span class="chess">&#x265a;</span>) 2 8 <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>)
</code></div>

<p>
Finds multiple-pin stalemates.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:ray">:ray</a>.
</p>

<h3 id="position:raydiagonal">:raydiagonal</h3>

<p>
This keyword function exactly like <a href="CQL-Position-List.html#position:ray">:ray</a> but the given rays
are restricted to being diagonal. A diagonal ray is a ray that is not vertical
or horizontal.
</p>

<h3 id="position:rayhorizontal">:rayhorizontal</h3>

<p>
This keyword function exactly like <a href="CQL-Position-List.html#position:ray">:ray</a> but the given rays
are restricted to being horizontal. A horizontal ray is a ray that is horizontal.
</p>

<h3 id="position:rayorthogonal">:rayorthogonal</h3>

<p>
This keyword function exactly like <a href="CQL-Position-List.html#position:ray">:ray</a> but the given rays
are restricted to being orthogonal. A orthogonal ray is a ray that is not
diagonal.
</p>

<h3 id="position:rayvertical">:rayvertical</h3>

<p>
This keyword function exactly like <a href="CQL-Position-List.html#position:ray">:ray</a> but the given rays
are restricted to being vertical. A vertical ray is a ray that is vertical.
</p>

<h2 id="move">Move keywords</h2>

<p>
In a position, the next move is the move about to be played, if any. A move has
three charactistics: its from designator, its to designator and its promotion
designator. These refer respectively to the piece and square from which the
piece moves; to the piece and square to which it is going to move (but before
it actually moves there), and to the piece and square to which it promotes,
if any.
</p>

<p>
For example, the to designation of a white rook on a4 capturing a black knight
on d4 is <span class="chess">&#x265e;</span>d4, and its from designation is <span class="chess">&#x2656;</span>a4. The to designation of a move to
e4 that is not a capture is .e4. 
</p>

<ul style="list-style-type: none"><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:enpassant">:enpassant</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:iscastling">:iscastling</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:movefrom">:movefrom</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:movenumber">:movenumber</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:moveto">:moveto</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:nocastling">:nocastling</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:noenpassant">:noenpassant</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:nopiecedrop">:nopiecedrop</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:piecedrop">:piecedrop</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:promote">:promote</a></td></tr>
  </table>
</li></ul>

<h3 id="position:enpassant">:enpassant</h3>

<p>
The next move is an en-passant capture.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:noenpassant">:noenpassant</a>
</p>

<h3 id="position:iscastling">:iscastling</h3>

<p>
The next move is a castling move.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<p>
See also: <a href="CQL-Position-List.html#position:nocastling">:nocastling</a>.
</p>

<h3 id="position:movefrom">:movefrom</h3>

<p>
Takes a single parameter, a piece designator. It matches a move whose from
designator matches that piece designator.
</p>

<p>
Examples:
</p>

<div class="verb"><code>
(position <span class="keyword">:movefrom</span> <span class="chess">&#x2656;</span>a3)
</code></div>

<p>
Matches a position in which the next move is of a white rook on a3.
</p>

<div class="verb"><code>
(position <span class="keyword">:movefrom</span> U?8)
</code></div>

<p>
Matches a position in the next move is of some piece on the 8th rank.
</p>

<h3 id="position:movenumber">:movenumber</h3>

<p>
:movenumber takes a range specifier as parameter and matches positions only
if the current move number is within the specified range. The move number
computation assumes white moves first, and might be one off otherwise.
</p>

<p>
Examples:
</p>

<div class="verb"><code>
(position <span class="keyword">:movenumber</span> 10 20 <a href="CQL-Position-List.html#position:check">:check</a>)
</code></div>

<p>
Matches a position in which there is a check between moves 10 and 20.
</p>

<div class="verb"><code>
(position <span class="keyword">:movenumber</span> 35 <a href="CQL-Position-List.html#position:mate">:mate</a>)
</code></div>

<p>
matches a position in which move 35 is mate.
</p>

<h3 id="position:moveto">:moveto</h3>

<p>
Takes a single parameter, a piece designator. It matches a move whose
to designator matches its parameter.
</p>

<p>
Examples:
</p>

<div class="verb"><code>
(position <span class="keyword">:moveto</span> .a3)
</code></div>

<p>
Matches a position in which the next move is to an empty square on a3.
</p>

<div class="verb"><code>
(position <span class="keyword">:moveto</span> <span class="chess">&#x2656;</span>[b1-8])
</code></div>

<p>
Matches a position in which the next move is to capture a white rook on
the b file. Note that this is quite different from the natural
<a href="http://de.wikipedia.org/wiki/Portable_Game_Notation">PGN<span class="awesome"/>&nbsp;&#xf08e;</span></a>
interpration of its being a move of a white rook to the b file. That
would be done via:
</p>

<div class="verb"><code>
(position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class="chess">&#x2656;</span> <span class="keyword">:moveto</span> ?b?)
</code></div>

<p>
which matches a move of the white rook to the b file.
</p>

<h3 id="position:nocastling">:nocastling</h3>

<p>
The next move is not a castling move.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<p>
See also: <a href="CQL-Position-List.html#position:iscastling">:iscastling</a>.
</p>

<h3 id="position:noenpassant">:noenpassant</h3>

<p>
The next move is not an en-passant capture.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:enpassant">:enpassant</a>.
</cql>

<h3 id="position:piecedrop">:piecedrop</h3>

<p>
The next move is a piece drop (possible only in chess variants
Crazyhouse Chess, and Bughouse Chess).
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>

<p>
Examples:
</p>

<div class="verb"><code>
(position <span class="keyword">:piecedrop</span> [<span class="chess">&#x2658;</span><span class="chess">&#x265e;</span>])
</code></div>

<p>
The next move is a piece drop which is dropping a knight.
</p>

<div class="verb"><code>
(position <span class="keyword">:piecedrop</span> [])
</code></div>

<p>
The next move is not a piece drop (because the piece designator
is empty).
</p>

<h3 id="position:promote">:promote</h3>

<p>
Takes a single parameter, a piece designator. It matches a move if that move
is a promotion whose promotion designator matches its parameter.
</p>

<p>
Examples:
</p>

<div class="verb"><code>
(position <span class="keyword">:promote</span> [<span class="chess">&#x2656;</span><span class="chess">&#x2657;</span><span class="chess">&#x2658;</span>])
</code></div>

<p>
Matches a position whose next move is a white underpromotion.
</p>

<div class="verb"><code>
(position <span class="keyword">:promote</span> [<span class="chess">&#x2657;</span><span class="chess">&#x2658;</span>]a8)
</code></div>

<p>
Matches a position whose next move is a white promotion to bishop or knight.
</p>

<div class="verb"><code>
(position <span class="keyword">:promote</span> [<span class="chess">&#x2656;</span>e8]
<a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class="chess">&#x2659;</span>f7 <a href="CQL-Position-List.html#position:moveto">:moveto</a> <span class="chess">&#x265b;</span>)
</code></div>

<p>
Matches a position in which the next move is of a pawn on f7 capturing a black
queen on e8 and promoting to a rook.
</p>

<div class="verb"><code>
(position <span class="keyword">:promote</span> [])
</code></div>

<p>
Matches a position in which the next move is not a promotion (because the
piece designator is empty).
</p>

<h2 id="sequence">Sequence keywords</h2>

<ul style="list-style-type: none"><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:gappedsequence">:gappedsequence</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:sequence">:sequence</a></td></tr>
  </table>
</li></ul>

<h3 id="position:gappedsequence">:gappedsequence</h3>

<p>
Takes one argument, a list of position lists. A position list A is said to be
a refinement of a position list B if A may be formed from B by inserting zero or
more position lists of the form (position) into the top level of B. For
example:

<div class="verb"><code>
((position <span class="chess">&#x2658;</span>a4) (position) (position <span class="chess">&#x2656;</span>b2))
</code></div>

<p>
refines
</p>

<div class="verb"><code>
((position <span class="chess">&#x2658;</span>a4) (position <span class="chess">&#x2656;</span>b2))
</code></div>

<p>
because it was formed by inserting a single position list into the latter list.
</p>

<p>
A :gappedsequence with argument B matches a position if and only if there is a
refinement A of B such that a <a href="CQL-Position-List.html#position:sequence">:sequence</a> with argument A
would match that position. That is, :gappedsequence is like
<a href="CQL-Position-List.html#position:sequence">:sequence</a> except that the sequence of matching positions
may include intervening positions from the game.
</p>

<p>
Examples:
</p>

<div class="box"><pre><code><!--
-->(position
  <span class="keyword">:gappedsequence</span> (
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class="chess">&#x2656;</span>a3)
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class="chess">&#x2656;</span>b4)))<!--
--></code></pre></div>

<p>
This will match any position for which the positions that occur successively
in the game starting with that position comprise zero or more positions,
followed by a position from which a white rook on a3 moves, followed by zero
or more positions, followed by a position from which a white rook on b4 moves.
In consequence the same effect can be obtained much more efficiently via:
</p>

<div class="box"><pre><code><!--
-->(position 
  <a href="CQL-Position-List.html#position:initial">:initial</a>
  <span class="keyword">:gappedsequence</span> (
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class="chess">&#x2656;</span>a3)
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class="chess">&#x2656;</span>b4)))<!--
--></code></pre></div>

<p>
The following position list matches a position in which a knight is on d4 at
some point in the game after that position:
</p>

<div class="box"><pre><code><!--
-->(position
  <span class="keyword">:gappedsequence</span> (
    (position)
    (position <span class="chess">&#x2658;</span>d4))) <!--
--></code></pre></div>

<p>
Note that the first element of the argument to :gappedsequence,
<span style="white-space:nowrap;"><code>(position)</code></span>, is used to ensure that only knights on d4 in
positions that occur after the position to be matched are considered.
</p>

<p>
This fragment is used here, to find all games in which some knight has
visited at least twenty different squares.
</p>

<p>
The total number of <a href="CQL-Position-List.html#position:sequence">:sequence</a> and :gappedsequence position
lists that can occur at the top level of a position list cannot exceed one. To
get the effect of both a :gappedequence and <a href="CQL-Position-List.html#position:sequence">:sequence</a>
keywords in one position list, use <a href="CQL-Position-List.html#position:and">:and</a>.
</p>

<h3 id="position:sequence">:sequence</h3>

<p>
Takes a single argument that is a list of position lists. It matches a given
position if and only successive occurring positions, beginning with the
current position, match each corresponding element in its argument.
</p>

<p>
Example:
</p>

<div class="box"><pre><code><!--
-->(position
  <span class="chess">&#x2656;</span>e8 
  <span class="keyword">:sequence</span> (
    (position <span class="chess">&#x2655;</span>f3 .g2)
    (position .f3 <span class="chess">&#x2655;</span>g2)))<!--
--></code></pre></div>

This position list matches exactly those positions with a white rook on e8
such that:

<ol>
  <li>In that position, white has a queen on f3 and g2 is empty, and</li>
  <li>After the next move, f3 is empty and there is a white queen on g2.</li>
</ol>

<p>
In consequence, this position list is identical in effect to
</p>

<div class="verb"><code>
(position <span class="chess">&#x2656;</span>e8 <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class="chess">&#x2655;</span>f3 <a href="CQL-Position-List.html#position:moveto">:moveto</a> .g2)
</code></div>

<p>
The following more typical usage of :sequence will search for all queen
staircase checking maneuvers by either side:
</p>

<div class="box"><pre><code><!--
-->(position 
  <a href="CQL-Position-List.html#position:shift">:shift</a> <a href="CQL-Position-List.html#position:flip">:flip</a> <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>
  <span class="keyword">:sequence</span> (
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class="chess">&#x2655;</span>a2) 
    (position <a href="CQL-Position-List.html#position:check">:check</a>) 
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class="chess">&#x2655;</span>b2) 
    (position <a href="CQL-Position-List.html#position:check">:check</a>) 
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class="chess">&#x2655;</span>b3) 
    (position <a href="CQL-Position-List.html#position:check">:check</a>) 
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class="chess">&#x2655;</span>c3)
    (position <a href="CQL-Position-List.html#position:check">:check</a>)
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class="chess">&#x2655;</span>c4)))<!--
--></code></pre></div>

<p>
This position list matches any position with a white queen on a2 for which
there are successively moves by queens on the indicated squares giving check;
the <a href="CQL-Position-List.html#position:shift">:shift</a>, <a href="CQL-Position-List.html#position:flip">:flip</a>, and
<a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a> search for this variation reflected or
rotated anywhere on the board.
<p>

<h2 id="game">Game related keywords</h2>

<p>
Several keywords relate to the game parameters and are not affected by the
contents of the position; they are included as position list keywords instead
of match list keywords so the <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a> can be used with
them. these are:
</p>

<ul style="list-style-type: none"><li>
  <table>
    <tr><td>      &#x2022;</td><td><a href="#position:elo">:elo</a></td>
        <td>&emsp;&#x2022;</td><td><a href="#position:whiteelo">:whiteelo</a></td>
        <td>&emsp;&#x2022;</td><td><a href="#position:blackelo">:blackelo</a></td></tr>
    <tr><td>      &#x2022;</td><td><a href="#position:rating">:rating</a></td>
        <td>&emsp;&#x2022;</td><td><a href="#position:whiterating">:whiterating</a></td>
        <td>&emsp;&#x2022;</td><td><a href="#position:blackrating">:blackrating</a></td></tr>
    <tr><td>      &#x2022;</td><td><a href="#position:result">:result</a></td></tr>
  </table>
</li></ul>

<h3 id="position:blackelo">:blackelo</h3>

<p>
This parameter takes a range specifier; the ELO of the black player must lie
within its range (&#x21d2; <a href="CQL-Range-Specifiers.html">range specifiers</a>).
</p>

<h3 id="position:blackrating">:blackrating</h3>

<p>
Match all games where the specified rating score of black player is between
given range.  For a detailed description see <a href="CQL-Match-List.html#match:rating (match)">:rating (match)</a>.
</p>

<h3 id="position:elo">:elo</h3>

<p>
This parameter expects a range specifer; the ELO of at least one of the
players must lie within the specified range (&#x21d2;
<a href="CQL-Range-Specifiers.html">range specifiers</a>)
</p>

<h3 id="position:rating">:rating</h3>

<p>
Match all games where the specified rating score of one player is between
given range.  For a detailed description see <a href="CQL-Match-List.html#match:rating (match)">:rating (match)</a>.
</p>

<h3 id="position:result">:result</h3>

<p>
This keyword takes one argument, the same as the argument to
<a href="CQL-Match-List.html#match:result (match)">:result (match)</a> in a match list.
</p>

<p>
Example:
</p>

<div class="box"><pre><code><!--
-->(position 
  <span class="keyword">:result</span> 1-0 
  <a href="CQL-Position-List.html#position:whiteelo">:whiteelo</a> 0 2300
  <a href="CQL-Position-List.html#position:blackelo">:blackelo</a> 2600 3000
  <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>)<!--
--></code></pre></div>

<p>
Searches for positions in which a 2300 player or below defeated a 2600 player
or above.
</p>

<h3 id="position:whiteelo">:whiteelo</h3>

<p>
This parameter takes a range specifier; the ELO of the white player must lie
within its range (&#x21d2; <a href="CQL-Range-Specifiers.html">range specifiers</a>).
</p>

<h3 id="position:whiterating">:whiterating</h3>

<p>
Match all games where the specified rating score of white player is between
given range.  For a detailed description see <a href="CQL-Match-List.html#match:rating (match)">:rating (match)</a>.
</p>

<h2 id="relation">Relation between positions</h2>

<ul style="list-style-type: none"><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:relation">:relation</a></td></tr>
  </table>
</li></ul>

<h3 id="position:relation">:relation</h3>

<p>
Takes one argument, a relation specification. is used to search for games with
pairs of positions P1 and P2 that satisfy certain properties. See
<a href="CQL-Relation-List.html">relation list</a> for a desription of
the relation specification keywords.
</p>

<h2 id="matching">Matching count keywords</h2>

<p>
Two keywords pertain to the number of positions which a position list matches.
These each take a range specifier as parameter. They can only be used in a
position list at the top level of a match list.
</p>

<ul style="list-style-type: none"><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:matchcount">:matchcount</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:pretransformmatchcount">:pretransformmatchcount</a></td></tr>
  </table>
</li></ul>

<h3 id="position:matchcount">:matchcount</h3>

<p>
Matches if and only if the number of times this position list matches a
position in the current game lies within the range specifier.
</p>

<p>
Example:
</p>

<div class="verb"><code>
(position <a href="CQL-Position-List.html#position:moveto">:moveto</a> [<span class="chess">&#x2655;</span><span class="chess">&#x265b;</span>] <span class="keyword">:matchcount</span> 4 100)
</code></div>

<p>
Matches any game in which at least four queen captures have occurred.
</p>

<h3 id="position:pretransformmatchcount">:pretransformmatchcount</h3>

<p>
Has the same syntax as <a href="CQL-Position-List.html#position:matchcount">:matchcount</a>. It matches a position if
and only if there is some transform in the transformation set associated with
the position list in which it occurs such that, were the position list
replaced by a new position list formed from the first by deleting all
transformation keywords, applying the transform to that position list, and
changing this keyword to <a href="CQL-Position-List.html#position:matchcount">:matchcount</a>, then the position
list would match the position.
</p>

<p>
Example:
</p>

<div class="box"><pre><code><!--
-->(position
  <a href="CQL-Position-List.html#position:movetoy">:movetoy</a> [Aa]d4 
  <span class="keyword">:pretransformmatchcount</span> 12 1000
  <a href="CQL-Position-List.html#position:shift">:shift</a>))<!--
--></code></pre></div>

<p>
This would match any game in which at least 12 captures occur on the same
square. Were the :pretransformmatchcount replaced by
<a href="CQL-Position-List.html#position:matchcount">:matchcount</a>, the position list would match games in which
at least 12 captures occurred.
</p>

<h2 id="accumulator">Accumulator keywords</h2>

<p>
There are mainly two accumulator keywords, :accumulate and :sumrange. These
are used to accumulate and to test the number of transforms of the enclosing
position list that match the current position. Each time a transform of a
position list matches a position, the accumulator associated with that position
is incremented. Any position with a sum range can then test if the accumulator
is within a certain range.
</p>

<ul style="list-style-type: none"><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:accumulate">:accumulate</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:reset">:reset</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:sumrange">:sumrange</a></td></tr>
  </table>
</li></ul>

<h3 id="position:accumulate">:accumulate</h3>

<p>
This takes one parameter, the name of an accumulator. Each time the application
of some element of the transform set of the position list matches a position,
the accumulator associated with this name is incremented. The accumulator is
cleared when a new position is reached (and in consequence :accumulate should
not be used inside of <a href="CQL-Position-List.html#position:not">:not</a>, or the
<a href="CQL-Position-List.html#position:sequence">:sequence</a>, and <a href="CQL-Position-List.html#position:gappedsequence">:gappedsequence</a> keywords).
This keyword inhibits short-circuiting of logical keywords
<a href="CQL-Position-List.html#position:and">:and</a>, and <a href="CQL-Position-List.html#position:or">:or</a>. Note that
<a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a> likely has unexpected results when used with
:accumulate, because the accumulator is not cleared between color flips.
</p>

<p>
For examples see:
<a href="CQL-Examples#accumulator">Using accumulators to count passed pawns</a>.
</p>

<h3 id="position:reset">:reset</h3>

<p>
This keyword takes as a parameter the name of an accumulator. It clears the
accumulator associated with this name after applying a transformation.
</p>

<p><img src="../images/note.png" alt="note" /> This keyword is not part of the CQL standard.</p>
<p><img src="../images/note.png" alt="note" /> This keyword is borrowed from Chess Assistant 9 (&#x21d2; <a href="http://hornid.com/chess/docs/CQL-3GX.pdf">The CQL 3.GX Extension<span class="awesome"/>&nbsp;&#xf08e;</span></a>).

<p>
Example:
</p>

</p>
Tripled pawns can be found by the query:
</p>

<div class="box"><pre><code><!--
-->(position
  <span class="keyword">:reset</span> acc
  <span class="chess">&#x2659;</span>e2
  <a href="CQL-Position-List.html#position:accumulate">:accumulate</a> acc
  <a href="CQL-Position-List.html#position:sumrange">:sumrange</a> acc 3
  <a href="CQL-Position-List.html#position:shiftvertical">:shiftvertical</a>
  <a href="CQL-Position-List.html#position:shifthorizontal">:shifthorizontal</a>)<!--
--></code></pre></div>

<p>
Note that this is only an example for this keyword (taken from
<a href="http://hornid.com/chess/docs/CQL-3GX.pdf">The CQL 3.GX Extension<span class="awesome"/>&nbsp;&#xf08e;</span></a>),
it is not recommended to use this statement for triple pawn search.
A much better way is:
</p>

<div class="box"><pre><code><!--
-->(position
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class="chess">&#x2659;</span>a[3-7] 3 6
  <a href="CQL-Position-List.html#position:shifthorizontal">:shifthorizontal</a>
  <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>))<!--
--></code></pre></div>

<h3 id="position:sumrange">:sumrange</h3>

<p>
This takes as parameter the name of an accumulator and a range specifer.
It matches a position if the value of the given accumulator lies within
the range specifier.
</p>

<p>
For examples see:
<a href="CQL-Examples#accumulator">Using accumulators to count passed pawns</a>.
</p>

<h2 id="tagging">Tagging keywords</h2>

<ul style="list-style-type: none"><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:tagmatch">:tagmatch</a></td></tr>
  </table>
</li></ul>

<h3 id="position:tagmatch">:tagmatch</h3>

<p>
The :tagmatch keyword takes two parameters, the name of a tag and a piece
designator. It matches only if the piece corresonding to the named tag
matches the given piece designator. For more information, see the section
on <a href="CQL-Tagging.html">tagging</a>.
</p>

</body>
</html>
