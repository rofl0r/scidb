<?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated from tcl/help/en/CQL-Position-List.txt -->

<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<head>
  <meta http-equiv="content-type"
           content="text/html; charset=utf-8" />
  <meta http-equiv="content-language"
           content="en" />
  <meta http-equiv="content-style-type"
           content="text/css" />

  <meta name="author"
     content="scidb.sourceforge.net" />
  <meta name="generator"
     content="scidb.sourceforge.net" />
  <meta name="description"
     content="Scidb Help Page" />

  <link rel="icon"
       href="http://scidb.sourceforge.net/images/scidb.ico"
       type="image/x-icon" />
  <link rel="shortcut icon"
       href="http://scidb.sourceforge.net/images/scidb.ico" />
  <link rel="stylesheet"
       type="text/css"
      media="screen"
       href="../styles/help.css" />

  <title>Scidb Help: CQL - The position list</title>
</head>

<body>

<div class="title">
  <h1 class="title">CQL - The position list</h1>
</div>

<p>
The symbol <img src="../images/ft-scidb-tiny.png" alt="" />  in the title of a
keyword description denotes that this keyword is an extension, it is not
part of the CQL standard.
</p>

<p>
The keywords <a href="CQL-Position-List.html#position:castling">:castling</a>, <a href="CQL-Position-List.html#position:endgame">:endgame</a>,
<a href="CQL-Position-List.html#position:inside">:inside</a>, and <a href="CQL-Position-List.html#position:reset">:reset</a> are borrowed from
Chess Assistant 9. The description of these keywords are taken from
<a href="http://hornid.com/chess/docs/CQL-3GX.pdf">The CQL 3.GX Extension<span class="awesome">&nbsp;&#xf08e;</span></a>.
</p>

<ul style='list-style-type: none'><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#index">Index</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#logical">Logical keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#control">Controlling keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#simple">Simple keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#transform">Transformation keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#piece">Piece configuration keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#move">Move keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#sequence">Logical keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#game">Game related keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#relation">Relation between positions</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#matching">Matching count keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#evaluation">Analyzing keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#accumulator">Accumulator keywords</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#tagging">Tagging keywords</a></td></tr>
  </table>
</li></ul>

<h2 id="index">Index</h2>

<ul style='list-style-type: none'><li>
  <table>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:accumulate">:accumulate</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:inside">:inside</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:pretransformmatchcount">:pretransformmatchcount</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:and">:and</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:iscastling">:iscastling</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:promote">:promote</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:attackcount">:attackcount</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:losing">:losing</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:rating">:rating</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:blackcannotwin">:blackcannotwin</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:markall">:markall</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:ray">:ray</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:blackelo">:blackelo</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:matchcount">:matchcount</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:rayattack">:rayattack</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:blackrating">:blackrating</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:mate">:mate</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:raydiagonal">:raydiagonal</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:btm">:btm</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:matingmaterial">:matingmaterial</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:rayhorizontal">:rayhorizontal</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:castling">:castling</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:maxswapevaluation">:maxswapevaluation</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:rayorthogonal">:rayorthogonal</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:check">:check</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:moveevaluation">:moveevaluation</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:rayvertical">:rayvertical</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:checkcount">:checkcount</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:movefrom">:movefrom</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:relation">:relation</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:contactcheck">:contactcheck</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:movenumber">:movenumber</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:repetition">:repetition</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:cut">:cut</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:moveto">:moveto</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:reset">:reset</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:doublecheck">:doublecheck</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:noannotate">:noannotate</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:result">:result</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:elo">:elo</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:nocastling">:nocastling</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:sequence">:sequence</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:endgame">:endgame</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nocheck">:nocheck</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:shift">:shift</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:enpassant">:enpassant</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nocontactcheck">:nocontactcheck</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:shiftdiagonal">:shiftdiagonal</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:evaluation">:evaluation</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nodoublecheck">:nodoublecheck</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:shifthorizontal">:shifthorizontal</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:exchangeevaluation">:exchangeevaluation</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:noendgame">:noendgame</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:shiftmaindiagonal">:shiftmaindiagonal</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:exclude">:exclude</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:noenpassant">:noenpassant</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:shiftoffdiagonal">:shiftoffdiagonal</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:fen">:fen</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:nolosing">:nolosing</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:shiftvertical">:shiftvertical</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:fiftymoverule">:fiftymoverule</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:nomate">:nomate</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:stalemate">:stalemate</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:flip">:flip</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:nomatingmaterial">:nomatingmaterial</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:sumrange">:sumrange</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:flipcolor">:flipcolor</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nostalemate">:nostalemate</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:tagmatch">:tagmatch</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:flipdihedral">:flipdihedral</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:not">:not</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:terminal">:terminal</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:flipdiagonal">:flipdiagonal</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:or">:or</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:variations">:variations</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:fliphorizontal">:fliphorizontal</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:piececount">:piececount</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:variationsonly">:variationsonly</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:flipvertical">:flipvertical</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:piecedrop">:piecedrop</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:whitecannotwin">:whitecannotwin</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:gameisover">:gameisover</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:power">:power</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:whiteelo">:whiteelo</a></td>
    </tr>
    <tr>
    	<td>      &#x2022;</td><td><a href="#position:gappedsequence">:gappedsequence</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:powerdifference">:powerdifference</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:whiterating">:whiterating</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:halfmoveclocklimit">:halfmoveclocklimit</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:preceding">:preceding</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:wtm">:wtm</a></td>
    </tr>
  </table>
</li></ul>

<h2 id="logical">Logical keywords</h2>

<ul style='list-style-type: none'><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:and">:and</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:not">:not</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:or">:or</a></td></tr>
  </table>
</li></ul>

<h3 id="position:and">:and</h3>

<p>
Takes a list of position lists and matches a position only if each of them
match the position.
</p>

<p>
Example:
</p>

<div class='box'><pre><code><!--
-->(position 
  <a href="CQL-Position-List.html#position:wtm">:wtm</a>
  <a href="CQL-Position-List.html#position:check">:check</a>
  <span class='keyword'>:and</span> (
    (position <span class='piece'>&#x2654;</span>e2 <span class='piece'>&#x265a;</span>g2 <a href="CQL-Position-List.html#position:shift">:shift</a> <a href="CQL-Position-List.html#position:flip">:flip</a>)
    (position <span class='piece'>&#x2658;</span>e2)))<!--
--></code></pre></div>

<p>
Matches positions in which the kings are in opposition, there is a white knight
on e2, and white is in check.
</p>

<h3 id="position:not">:not</h3>

<p>
This keyword can be used in two forms: either it is included in a position
match list, or it has a sub-position list as argument. In former case:
match if the containing match list would not match without the :not. In
latter case negate the result of the sub-position list match. The former
case is conform with CQL standard of keyword <a href="CQL-Position-List.html#position:not">:not</a>,
the second form is an extension.
</p>

<p>
Examples:
</p>

<div class='box'><pre><code><!--
-->(match
  (position
    ; <span class='comment'>we are searching for both colors</span>
    <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>
    <span class='comment'>; the mating position must match each criterion below</span>
    <a href="CQL-Position-List.html#position:and">:and</a> (
      <span class='comment'>; the black king is surrounded by empty squares and</span>
      <span class='comment'>; is attacked once and is in mate</span>
      (position
        <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> <span class='piece'>&#x265a;</span> . 8
        <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> A <span class='piece'>&#x265a;</span> 1
        <a href="CQL-Position-List.html#position:mate">:mate</a>
        <a href="CQL-Position-List.html#position:btm">:btm</a>)
      <span class='comment'>; check that no neighbor of the black king is</span>
      <span class='comment'>; attacked more than once</span>
      (position
        <span class='keyword'>:not</span>
        <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> <span class='piece'>&#x265a;</span> .e4 1
        <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> A .e4 2 100
        <a href="CQL-Position-List.html#position:shift">:shift</a>))))<!--
--></code></pre></div>

<p>
This finds all mating positions in which the king is surrounded by empty squares.
</p>

<p>
The follwing position match
</p>

<div class='verb'><code>
(position <span class='piece'>&#x2656;</span>a3 <span class='keyword'>:not</span>)
</code></div>

<p>
is equivalent to
</p>

<div class='verb'><code>
(position [a<span class='piece'>&#x2655;</span><span class='piece'>&#x2657;</span><span class='piece'>&#x2658;</span><span class='piece'>&#x2659;</span><span class='piece'>&#x2654;</span>.]a3)
</code></div>

<h3 id="position:or">:or</h3>

<p>
Takes a list of position lists and matches a position only if at least one of them matches the position.
</p>

<p>
Example:
</p>

<div class='box'><pre><code><!--
-->(match
  (position
    <span class='keyword'>:or</span> (
      (position <a href="CQL-Position-List.html#position:piececount">:piececount</a>
        <span class='piece'>&#x2657;</span>[a1,a3,a5,a7,b2,b4,b6,b8,c1,c3,c5,c7,d2,d4,d6,d8,e1,
        e3,e5,e7,f2,f4,f6,f8,g1,g3,g5,g7,h2,h4,h6,h8] 2 9)
      (position <a href="CQL-Position-List.html#position:piececount">:piececount</a>
        <span class='piece'>&#x265d;</span>[a1,a3,a5,a7,b2,b4,b6,b8,c1,c3,c5,c7,d2,d4,d6,d8,e1,
        e3,e5,e7,f2,f4,f6,f8,g1,g3,g5,g7,h2,h4,h6,h8] 2 9)
      (position <a href="CQL-Position-List.html#position:piececount">:piececount</a>
        <span class='piece'>&#x265d;</span>[a2,a4,a6,a8,b1,b3,b5,b7,c2,c4,c6,c8,d1,d3,d5,d7,e2,
        e4,e6,e8,f1,f3,f5,f7,g2,g4,g6,g8,h1,h3,h5,h7] 2 9)
      (position <a href="CQL-Position-List.html#position:piececount">:piececount</a>
        <span class='piece'>&#x2657;</span>[a2,a4,a6,a8,b1,b3,b5,b7,c2,c4,c6,c8,d1,d3,d5,d7,e2,
        e4,e6,e8,f1,f3,f5,f7,g2,g4,g6,g8,h1,h3,h5,h7] 2 9))))<!--
--></code></pre></div>

<p>
Searching for games with that have either two light-squared white
bishops, two dark-squared white bishops, two dark-square black
bishops. or two light-square black bishops.
</p>

<h2 id="control">Controlling keywords</h2>

<p>
With the help of the controlling keywords <a href="CQL-Position-List.html#position:cut">:cut</a> or
<a href="CQL-Position-List.html#position:exclude">:exclude</a> unwanted positions or even games can be
excluded. Keyword <a href="CQL-Position-List.html#position:preceding">:preceding</a> gives the predecessing
position of a match.
</p>

<p>
Actually these keywords are not extending the capability of CQL, each of
them can be replaced, but the use of this keywords may improve the search
time considerably, and the expression may have a clearer form.
</p>

<ul style='list-style-type: none'><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:cut">:cut</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:exclude">:exclude</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:preceding">:preceding</a></td></tr>
  </table>
</li></ul>

<h3 id="position:cut">:cut&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
This keyword can be used in two forms: either it is included in a position
match list, or it has a sub-position list as argument. In former case:
stop position search for this game as soon as the match of containing position
list succeeds. In latter case stop position search as soon as the match of
the sub-position list succeeds. This keyword is never failing, with other
words: it is not influencing the result of all other position lists.
</p>

<p>
The :cut position match has lower precedence than all other position matches.
This means that the position, where all position lists are succeeding, is
matching. If the :cut position match should have highest precedende, use
keyword <a href="CQL-Position-List.html#position:preceding">:preceding</a>, see examples:
</p>

<div class='verb'><code>
(match (position &lt;A&gt; <span class='keyword'>:cut</span> (&lt;B&gt;))
</code></div>

<p>
Suppose &lt;A&gt; and &lt;B&gt; succeeds, both the first time. In this
case the match succeeds.
</p>

<div class='verb'><code>
(match (position &lt;A&gt; <span class='keyword'>:cut</span> (<a href="CQL-Position-List.html#position:preceding">:preceding</a>  &lt;B&gt;)))
</code></div>

<p>
Suppose &lt;A&gt; and &lt;B&gt; succeeds, both the first time. In this
case the match fails.
</p>

<p>
Examples:
</p>

<div class='box'><pre><code><!--
-->(match
  (position
    <a href="CQL-Position-List.html#position:mate">:mate</a>
    <span class='keyword'>:cut</span> (<a href="CQL-Position-List.html#position:check">:check</a>)))<!--
--></code></pre></div>

<p>
Search for games ending with mate, and neither side has ever given
a check before. Actually keyword :cut is not required for this search,
see next example:
</p>

<div class='box'><pre><code><!--
-->(match
  (position <a href="CQL-Position-List.html#position:mate">:mate</a>)
  (position <a href="CQL-Position-List.html#position:check">:check</a> <a href="CQL-Position-List.html#position:matchcount">:matchcount</a> 1))<!--
--></code></pre></div>

<p>
But this version has to search the whole game, and the former version with
:cut fails as soon as first check occurs. In complex searches the use of
keyword :cut may be much faster than the use of :matchcount.
</p>

<h3 id="position:exclude">:exclude&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
This keyword can be used in two forms: either it is included in a position
match list, or it has a sub-position list as argument. In former case:
exclude this game if the match of containing position list succeeds.
In latter case exclude this game if the match of the sub-position list
succeeds. This keyword is not influencing the result of the position
match (see example).
</p>

<p>
This keyword will exclude games even if one of the position matches
will succeed before the :exclude expression will succeed.
Keyword :exclude is excluding games under certain conditions.
</p>

<p>
Example:
</p>

<div class='box'><pre><code><!--
-->(match
  (position
    &lt;A&gt;
    <span class='keyword'>:exclude</span> (position &lt;B&gt;)))<!--
--></code></pre></div>

<p>
Search for games matching expression <span style='white-space:nowrap;'><code>&lt;A&gt;</code></span>, but not if
expression <span style='white-space:nowrap;'><code>&lt;B&gt;</code></span> is matching any position in this game.
Actually this match can be written without the use of keyword :exclude,
in the following way:
</p>

<div class='box'><pre><code><!--
-->(match
  (position
    <a href="CQL-Position-List.html#position:gappedsequence">:gappedsequence</a> (
      (position &lt;B&gt; <a href="CQL-Position-List.html#position:not">:not</a>)
      (position &lt;A&gt;)
      (position &lt;B&gt; <a href="CQL-Position-List.html#position:not">:not</a>))))<!--
--></code></pre></div>

<p>
But the use of keyword :exclude is simpler, and the search is faster, because
the latter version has to search the whole game, and the former version with
keyword :exclude terminates as soon as <span style='white-space:nowrap;'><code>&lt;B&gt;</code></span> is matching.
</p>

<h3 id="position:preceding">:preceding&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
This keyword gives the preceding position of a match, if any. If the start
position is matching, the match of this position will be ignored, and the
search is continuing. The keyword :preceding can be used only on top level.
</p>

<p>
This keyword has a special meaning if combined with keyword
<a href="CQL-Position-List.html#position:cut">:cut</a>.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
position <a href="CQL-Position-List.html#position:check">:check</a> <span class='keyword'>:preceding</span>
</code></div>

<p>
The result of this match is the predecessor of first position where one
side has given a check. Of course this can be expressed without this keyword:
</p>

<div class='verb'><code>
position <a href="CQL-Position-List.html#position:sequence">:sequence</a>
((position <a href="CQL-Position-List.html#position:nocheck">:nocheck</a>) (position <a href="CQL-Position-List.html#position:check">:check</a>))
</code></div>

<p>
But the usage of :preceding is easier and the search is faster.
</p>

<h2 id="simple">Simple keywords</h2>

<ul style='list-style-type: none'><li>
  <table>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:blackcannotwin">:blackcannotwin</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:matingmaterial">:matingmaterial</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:btm">:btm</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:noannotate">:noannotate</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:castling">:castling</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nocheck">:nocheck</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:check">:check</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nocontactcheck">:nocontactcheck</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:checkcount">:checkcount</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nodoublecheck">:nodoublecheck</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:contactcheck">:contactcheck</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:noendgame">:noendgame</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:doublecheck">:doublecheck</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:nomate">:nomate</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:endgame">:endgame</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:nomatingmaterial">:nomatingmaterial</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:fen">:fen</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:nostalemate">:nostalemate</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:fiftymoverule">:fiftymoverule</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:repetition">:repetition</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:gameisover">:gameisover</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:stalemate">:stalemate</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:halfmoveclocklimit">:halfmoveclocklimit</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:terminal">:terminal</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:initial">:initial</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:variations">:variations</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:losing">:losing</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:variationsonly">:variationsonly</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:markall">:markall</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:whitecannotwin">:whitecannotwin</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:mate">:mate</a></td>
    	<td>&emsp;&#x2022;</td><td><a href="#position:wtm">:wtm</a></td>
    </tr>
  </table>
</li></ul>

<h3 id="position:blackcannotwin">:blackcannotwin&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
Match only if black cannot win in this position.
</p>

<p>
Normally this is equivalent to following query:
</p>

<div class='box'><pre><code><!--
--><a href="CQL-Position-List.html#position:or">:or</a> (
  <span class='comment'>; black king only</span>
  (<a href="CQL-Position-List.html#position:piececount">:piececount</a> a 1)
  <span class='comment'>; black king and black minor piece only</span>
  (<a href="CQL-Position-List.html#position:piececount">:piececount</a> a 2 <a href="CQL-Position-List.html#position:piececount">:piececount</a> i 1))<!--
--></code></pre></div>

<p>
In chess variant Three-check Chess this query succeeds only if
black has no more pieces than the king, and in all other chess variants this
query has no meaning and is always failing.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:whitecannotwin">:whitecannotwin</a>
</p>

<h3 id="position:btm">:btm</h3>

<p>
Match only if black is to move.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:wtm">:wtm</a>.
</p>

<h3 id="position:check">:check</h3>

<p>
One side is in check.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:nocheck">:nocheck</a>, <a href="CQL-Position-List.html#position:doublecheck">:doublecheck</a>,
<a href="CQL-Position-List.html#position:nodoublecheck">:nodoublecheck</a>, <a href="CQL-Position-List.html#position:contactcheck">:contactcheck</a>,
<a href="CQL-Position-List.html#position:nocontactcheck">:nocontactcheck</a>.
</p>

<h3 id="position:checkcount">:checkcount&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
If the parameter is a single number (between 0 and 3 is allowed), it is
matching all positions where last move is giving n-th check to other side.
</p>

<p>
If the parameter has the form <span style='white-space:nowrap;'><code>+&lt;n&#x2081;&gt;+&lt;n&#x2082;&gt;</code></span>,
where <span style='white-space:nowrap;'><code>&lt;n&#x2093;&gt;</code></span> is a number between 0 and 3,
it is matching all positions where white has given n&#x2081;-th check
to black, and black has given n&#x2082;-th check to white.
</p>

<p><img src='../images/note.png' alt='note' /> 
This query is working only in chess variant Three-check Chess,
in other chess variants it fails always.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:checkcount</span> 2)
</code></div>

<p>
Match if any side has given second check.
</p>

<div class='verb'><code>
(position <span class='keyword'>:checkcount</span> +0+3)
</code></div>

<p>
Match if black has given third check to white. This must be a final position.
</p>

<div class='verb'><code>
(position <a href="CQL-Position-List.html#position:not">:not</a> <span class='keyword'>:checkcount</span> +0+0)
</code></div>

<p>
This is in fact a useful match. Assume that a game is starting with the
following position (described with <a href="FEN.html">FEN</a>):
</p>

<ul style='list-style-type: none'><li><code>
rnb1k1nr/pppp1ppp/8/4p3/3PP2q/2N5/PP3PPP/R1BQKBNR w KQkq - 1 5 +0+2
</code></li></ul>

<p>
This game would match (note keyword :not), because black has already
given second check to white in first position of the game. With other
words, this example is searching for games starting with an advanced
position, where one side has already given a check.
</p>

<h3 id="position:castling">:castling&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
This keyword specifies castling availabilities for both sides. It takes as an
argument a piecetype designator, letters of which have the following meanings:
</p>

<ul style='list-style-type: none'><li>
  <table>
    <tr>
      <td class="l"><span style='white-space:nowrap;'><code><span class='piece'>&#x2654;</span></code></span></td>
      <td class="r">White has kingside castling availability</td>
    </tr>
    <tr>
      <td class="l"><span style='white-space:nowrap;'><code><span class='piece'>&#x2655;</span></code></span></td>
      <td class="r">White has queenside castling availability</td>
    </tr>
    <tr>
      <td class="l"><span style='white-space:nowrap;'><code><span class='piece'>&#x265a;</span></code></span></td>
      <td class="r">Black has kingside castling availability</td>
    </tr>
    <tr>
      <td class="l"><span style='white-space:nowrap;'><code><span class='piece'>&#x265b;</span></code></span></td>
      <td class="r">Black has queenside castling availability</td>
    </tr>
  </table>
</li></ul>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:castling</span> <span class='piece'>&#x2654;</span>)
</code></div>

<p>
White has kingside castling availability.
</p>

<div class='verb'><code>
(position <span class='keyword'>:castling</span> [<span class='piece'>&#x2654;</span><span class='piece'>&#x2655;</span>])
</code></div>

<p>
White has either kingside or queenside castling availability.
</p>

<div class='verb'><code>
(position <span class='keyword'>:castling</span> <span class='piece'>&#x2654;</span> <span class='keyword'>:castling</span> <span class='piece'>&#x2655;</span>)
</code></div>

<p>
White has both kingside and queenside castling availabilities.
</p>

<h3 id="position:contactcheck">:contactcheck&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
One side is in check, and it is a contact check.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:check">:check</a>, <a href="CQL-Position-List.html#position:nocheck">:nocheck</a>,
<a href="CQL-Position-List.html#position:doublecheck">:doublecheck</a>, <a href="CQL-Position-List.html#position:nodoublecheck">:nodoublecheck</a>,
<a href="CQL-Position-List.html#position:nocontactcheck">:nocontactcheck</a>.
</p>

<h3 id="position:doublecheck">:doublecheck&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
One side is in check, and it is a double check.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:check">:check</a>, <a href="CQL-Position-List.html#position:nocheck">:nocheck</a>,
<a href="CQL-Position-List.html#position:nodoublecheck">:nodoublecheck</a>, <a href="CQL-Position-List.html#position:contactcheck">:contactcheck</a>,
<a href="CQL-Position-List.html#position:nocontactcheck">:nocontactcheck</a>.
</p>

<h3 id="position:endgame">:endgame&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
The position is an endgame position. The keyword is equivalent to the following
query:
</p>

<div class='box'><pre><code><!--
-->  (position
    <a href="CQL-Position-List.html#position:or">:or</a> (
      (position
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] 0
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x2656;</span><span class='piece'>&#x2657;</span><span class='piece'>&#x2658;</span>] 0 3
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x265c;</span><span class='piece'>&#x265d;</span><span class='piece'>&#x265e;</span>] 0 3)
    (position
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x2655;</span> 1
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x265b;</span> 1
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x2656;</span><span class='piece'>&#x265c;</span>] 0
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> I 0 1
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> i 0 1)
    (position
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x2655;</span> 1
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x2656;</span> 0
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> I 0 1
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x265b;</span> 0
      <a href="CQL-Position-List.html#position:power">:power</a> [<span class='piece'>&#x265c;</span><span class='piece'>&#x265d;</span><span class='piece'>&#x265e;</span>] 0 16
      <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>)))<!--
--></code></pre></div>

<p>
See also: <a href="CQL-Position-List.html#position:noendgame">:noendgame</a>.
</p>

<h3 id="position:fen">:fen&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
The position is equal to the described position in given
<a href="FEN.html">FEN</a>.
</p>

<h3 id="position:fiftymoverule">:fiftymoverule&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
First position in game where no capture has been made and no pawn has been
moved in previous fifty consecutive moves.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:halfmoveclocklimit">:halfmoveclocklimit</a>.
</p>

<h3 id="position:gameisover">:gameisover&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
This is an abbreviation for:
</p>

<div class='box'><pre><code><!--
-->  <a href="CQL-Position-List.html#position:or">:or</a> (
    (position <a href="CQL-Position-List.html#position:mate">:mate</a>)
    (position <a href="CQL-Position-List.html#position:stalemate">:stalemate</a>)
    (position <a href="CQL-Position-List.html#position:losing">:losing</a>)
    (position <a href="CQL-Position-List.html#position:checkcount">:checkcount 3</a>)
    (position <a href="CQL-Position-List.html#position:nomatingmaterial">:nomatingmaterial</a>))<!--
--></code></pre></div>

<h3 id="position:initial">:initial</h3>

<p>
This is the first position in the game.
</p>

<h3 id="position:halfmoveclocklimit">:halfmoveclocklimit&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
This keyword is matching a position where the halfmove clock is equal
or less given limit.
</p>

<p>
Halfmove clock: This is the number of halfmoves since the last pawn
advance or capture. This is also used to determine if a draw can be
claimed under the fifty-move rule (&#x21d2; <a href="CQL-Position-List.html#position:fiftymoverule">:fiftymoverule</a>).
</p>

<p>
Example:
</p>

<div class='verb'><code>
<span class='keyword'>:halfmoveclocklimit</span> 30
</code></div>

<p>
Exclude all positions where no capture has been made and no pawn has been
moved in previous thirty halfmoves (15 moves by each side).
</p>

<p>
See also: <a href="CQL-Position-List.html#position:fiftymoverule">:fiftymoverule</a>.
</p>

<h3 id="position:losing">:losing&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
Matches the final position if one side has lost all pieces.
This is possible only in Antichess games.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:nolosing">:nolosing</a>.
</p>

<h3 id="position:markall">:markall</h3>

<p>
This keyword is supported to be compatible with CQL standard, and does
not have any meaning in Scidb.
</p>

<h3 id="position:mate">:mate</h3>

<p>
Match only if the position is a mate.
</p>

<div class='annotation'><img src='../images/annotation.png' style='float:left; margin:0 1em 0 0' alt='annotation' />
If searching for mate positions this keyword should always be used even if
this keyword might be superfluous because other conditions are ensuring a
mate position, it is accelerating the search (only testing final positions).
</div>

<p>
Example:
</p>

<div class='verb'><code>
(position <span class='keyword'>:mate</span> <a href="CQL-Position-List.html#position:movenumber">:movenumber</a> 1 20)
</code></div>

<p>
Only matches if one side is mated in first 20 moves.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:nomate">:nomate</a>.
</p>

<h3 id="position:matingmaterial">:matingmaterial&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
Match a position if either player has mating material (&#x21d2;
<a href="CQL-Position-List.html#position:nomatingmaterial">:nomatingmaterial</a>).
</p>

<p>
See also: <a href="CQL-Position-List.html#position:nomatingmaterial">:nomatingmaterial</a>.
</p>

<h3 id="position:noannotate">:noannotate</h3>

<p>
This keyword is supported to be compatible with CQL standard, and does
not have any meaning in Scidb.
</p>

<h3 id="position:nocheck">:nocheck</h3>

<p>
Neither side is in check.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:check">:check</a>, <a href="CQL-Position-List.html#position:doublecheck">:doublecheck</a>,
<a href="CQL-Position-List.html#position:nodoublecheck">:nodoublecheck</a>, <a href="CQL-Position-List.html#position:contactcheck">:contactcheck</a>,
<a href="CQL-Position-List.html#position:nocontactcheck">:nocontactcheck</a>.
</p>

<h3 id="position:nocontactcheck">:nocontactcheck&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
Neither side is in check, or it is not a contact check.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:check">:check</a>, <a href="CQL-Position-List.html#position:nocheck">:nocheck</a>,
<a href="CQL-Position-List.html#position:doublecheck">:doublecheck</a>, <a href="CQL-Position-List.html#position:nodoublecheck">:nodoublecheck</a>,
<a href="CQL-Position-List.html#position:contactcheck">:contactcheck</a>.
</p>

<h3 id="position:nodoublecheck">:nodoublecheck&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
Neither side is in check, or it is not a double check.
</p>

<h3 id="position:noendgame">:noendgame&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
The position is not an endgame position (&#x21d2;
<a href="CQL-Position-List.html#position:endgame">:endgame</a>).
</p>

<p>
See also: <a href="CQL-Position-List.html#position:endgame">:endgame</a>.
</p>

<h3 id="position:nomate">:nomate&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
Match only if the position is not mate.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:mate">:mate</a>.
</p>

<h3 id="position:nomatingmaterial">:nomatingmaterial&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
Match a position if neither player has mating material.
</p>

<p>
Normally this is equivalent to this query:
</p>

<div class='box'><pre><code><!--
--><a href="CQL-Position-List.html#position:or">:or</a> (
  <span class='comment'>; king versus king</span>
  (<a href="CQL-Position-List.html#position:piececount">:piececount</a> U 2)
  <span class='comment'>; king and minor piece versus king</span>
  (<a href="CQL-Position-List.html#position:piececount">:piececount</a> U 3 <a href="CQL-Position-List.html#position:piececount">:piececount</a> [Ii] 1)
  <span class='comment'>; king and bishop versus king and bishop with the bishops on the same color</span>
  (<a href="CQL-Position-List.html#position:piececount">:piececount</a> U 4 <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x2657;</span><span class='piece'>&#x265d;</span>][a1,a3,a5,a7,b2,b4,b6,b8,c1,c3,c5,c7,d2,d4,
                      d6,d8,e1,e3,e5,e7,f2,f4,f6,f8,g1,g3,g5,g7,h2,h4,h6,h8] 2)
  (<a href="CQL-Position-List.html#position:piececount">:piececount</a> U 4 <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x2657;</span><span class='piece'>&#x265d;</span>][a2,a4,a6,a8,b1,b3,b5,b7,c2,c4,c6,c8,d1,d3,
                      d5,d7,e2,e4,e6,e8,f1,f3,f5,f7,g2,g4,g6,g8,h1,h3,h5,h7] 2))<!--
--></code></pre></div>

<p>
In variant Three-check Chess this query only succeeds if only
kings are on board, and in all other chess variants this keyword has no
meaning and is always failing.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:matingmaterial">:matingmaterial</a>.
</p>

<h3 id="position:nostalemate">:nostalemate&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
Match only if the position is not a stalemate.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:stalemate">:stalemate</a>,
</p>

<h3 id="position:repetition">:repetition&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
Matches positions which occurred the third time in this game, with same
player to move, and each player has the same castling and en passant
capturing rights. The repeated positions need not occur in succession. This
accords with the <a href="http://en.wikipedia.org/wiki/Threefold_repetition">
threefold repetition rule<span class="awesome">&nbsp;&#xf08e;</span></a>.
</p>

<h3 id="position:stalemate">:stalemate</h3>

<p>
Match only if the position is a stalemate.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:nostalemate">:nostalemate</a>,
</p>

<h3 id="position:terminal">:terminal&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
This is the last position in the game.
</p>

<h3 id="position:variations">:variations</h3>

<p>
Look in the variations to find matches.
</p>

<h3 id="position:variationsonly">:variationsonly</h3>

<p>
Look only in the variations to find matches, not in the main line.
</p>

<h3 id="position:whitecannotwin">:whitecannotwin&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
Match only if white cannot win in this position.
</p>

<p>
Normally this is equivalent to following query:
</p>

<div class='box'><pre><code><!--
--><a href="CQL-Position-List.html#position:or">:or</a> (
  <span class='comment'>; white king only</span>
  (<a href="CQL-Position-List.html#position:piececount">:piececount</a> A 1)
  <span class='comment'>; white king and white minor piece only</span>
  (<a href="CQL-Position-List.html#position:piececount">:piececount</a> A 2 <a href="CQL-Position-List.html#position:piececount">:piececount</a> I 1))<!--
--></code></pre></div>

<p>
In chess variant Three-check Chess this query succeeds only if
white has no more pieces than the king, and in all other chess variants this
query has no meaning and is always failing.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:blackcannotwin">:blackcannotwin</a>
</p>

<h3 id="position:wtm">:wtm</h3>

<p>
Match only if white is to move.
</p>

<h2 id="transform">Transformation keywords</h2>

<ul style='list-style-type: none'><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:flip">:flip</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:flipcolor">:flipcolor</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:flipdiagonal">:flipdiagonal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:flipdihedral">:flipdihedral</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:fliphorizontal">:fliphorizontal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:flipvertical">:flipvertical</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:inside">:inside</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:shift">:shift</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:shiftdiagonal">:shiftdiagonal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:shifthorizontal">:shifthorizontal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:shiftmaindiagonal">:shiftmaindiagonal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:shiftoffdiagonal">:shiftoffdiagonal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:shiftvertical">:shiftvertical</a></td></tr>
  </table>
</li></ul>

<h3 id="position:flip">:flip</h3>

<p>
Same as <a href="CQL-Position-List.html#position:flipdihedral">:flipdihedral</a> (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:flipcolor">:flipcolor</h3>

<p>
The color flip transformation (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:flipdiagonal">:flipdiagonal</h3>

<p>
The diagonal flip transformation (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:flipdihedral">:flipdihedral</h3>

<p>
All dihedral transformations (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:fliphorizontal">:fliphorizontal</h3>

<p>
The horizontal flip transformation (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:flipvertical">:flipvertical</h3>

<p>
The vertical flip transformation (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:inside">:inside&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
This keyword filters shift transformations in order to some matching pieces
will stay inside a specified region of the board. It takes two arguments, a
piece designator and a square designator. Any shift transformation affects
only the first argument. A shift transformation match :inside limitation if
at least one piece matching the first argument (taking into account the
transformation) is placed on a square matching the second argument.
</p>

<p>
Example:
</p>

<p>
We use the following query to find tripled pawns:
</p>

<div class='box'><pre><code><!--
-->(position
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x2659;</span>[b2-7] 3
  <a href="CQL-Position-List.html#position:shifthorizontal">:shifthorizontal</a>)<!--
--></code></pre></div>

<p>
To find one of tripled pawns placed on the main diagonal we design the query
</p>

<div class='box'><pre><code><!--
-->(position
  <span class='keyword'>:inside</span> <span class='piece'>&#x2659;</span>[b2-7] [b2,c3,d4,e5,f6,g7]
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x2659;</span>[b2-7] 3
  <a href="CQL-Position-List.html#position:shifthorizontal">:shifthorizontal</a>)<!--
--></code></pre></div>

<h3 id="position:shift">:shift</h3>

<p>
The shift transformations (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:shiftdiagonal">:shiftdiagonal</h3>

<p>
The off-diagonal and main-diagonal shift transformations (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:shifthorizontal">:shifthorizontal</h3>

<p>
The horizontal shift transformations (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:shiftmaindiagonal">:shiftmaindiagonal</h3>

<p>
The main-diagonal shift transformations (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:shiftoffdiagonal">:shiftoffdiagonal</h3>

<p>
The off-diagonal shift transformations. (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h3 id="position:shiftvertical">:shiftvertical</h3>

<p>
The vertical shift transformations (&#x21d2;
<a href="CQL-Transformations.html">Transformations</a>).
</p>

<h2 id="piece">Piece configuration keywords</h2>

<ul style='list-style-type: none'><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:attackcount">:attackcount</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:piececount">:piececount</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:power">:power</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:powerdifference">:powerdifference</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:ray">:ray</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:rayattack">:rayattack</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:raydiagonal">:raydiagonal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:rayhorizontal">:rayhorizontal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:rayorthogonal">:rayorthogonal</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:rayvertical">:rayvertical</a></td></tr>
  </table>
</li></ul>

<h3 id="position:attackcount">:attackcount</h3>

<p>
This keyword takes as arguments two piece designators followed by a range
specifier. The first piece designator is the attacker piece designator.
The second piece designator is the attacked piece designator. An attack by
a piece to a square occurs if the piece could move to that square were it
empty and disregarding any possible checks. A valid attack is an attack by
a piece on a square that matches the attacker piece designator to a square
on which is a piece that matches the attacking piece designator.
</p>

<p>
The :attackcount keyword matches a position if the total number
of valid attacks in the position lies with the range given by its range
specifier.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:attackcount</span> A <span class='piece'>&#x265a;</span> 2)
</code></div>

<p>
Matches any position in which white has a double attack on the black king.
</p>

<div class='verb'><code>
(position <span class='keyword'>:attackcount</span> A <span class='piece'>&#x265a;</span> 2 <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>)
</code></div>

<p>
Matches any position in which a king is under double attack.
</p>

<div class='verb'><code>
(position <span class='keyword'>:attackcount</span> A .h3 1)
</code></div>

<p>
Matches a position in which exactly one white piece attacks an empty h3 square.
</p>

<div class='verb'><code>
(position <span class='keyword'>:attackcount</span> [<span class='piece'>&#x2656;</span><span class='piece'>&#x2657;</span>][a-c8] ??1 5 9
</code></div>

<p>
Matches a position in which the number of times a white rook or white bishop
on a8, b8, or c8 attacks a square on the first rank is between 5 and 9
inclusive.
</p>

<div class='verb'><code>
(position <span class='keyword'>:attackcount</span> <span class='piece'>&#x265e;</span> [<span class='piece'>&#x2654;</span><span class='piece'>&#x2656;</span><span class='piece'>&#x2655;</span>] 3 100) 
</code></div>

<p>
Matches position for which the number of times a black knight attacks a white
King or white major piece is at least 3.
</p>

<h3 id="position:piececount">:piececount</h3>

<p>
This keyword takes a piece designator argument followed by a range specifier.
It matches the position if and only if the number of occurrences of the piece
designator in the position is given by the range specifier.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:piececount</span> <span class='piece'>&#x2656;</span> 2)
</code></div>

<p>
This will match any position with exactly two white rooks - a position with
three white rooks would fail to match.
</p>

<div class='box'><pre><code><!--
-->(position 
  <span class='keyword'>:piececount</span> [<span class='piece'>&#x2656;</span><span class='piece'>&#x265c;</span>][a1-8] 1 3 
  <span class='keyword'>:piececount</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>][a-h8] 4 
  <span class='piece'>&#x2658;</span>d4)<!--
--></code></pre></div>

<p>
This will match any position with a white knight on d4, between one and three
rooks on the a file, and exactly four queens on the eight rank. Another way
to write this position list is:
</p>

<div class='box'><pre><code><!--
-->(position 
  <span class='piece'>&#x2658;</span>d4
  <span class='keyword'>:piececount</span> [<span class='piece'>&#x2656;</span><span class='piece'>&#x265c;</span>][a?] 1 3 
  <span class='keyword'>:piececount</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>][?8] 4)<!--
--></code></pre></div>

<h3 id="position:power">:power</h3>

<p>
This keyword takes as argument a piece designator followed by a range
specifier. It matches positions for which the total power of all pieces
in the position matching the piece designator lies within the range specifier.
The power of a piece is their chess material power, depending on the chess
variant:
</p>

<ul style='list-style-type: none'><li>
  <table cellpadding="3">
    <tr>
      <td align="right"></td>
      <td align="right"><span class='chess'>&#x2654;</span></td>
      <td align="right"><span class='chess'>&#x2655;</span></td>
      <td align="right"><span class='chess'>&#x2656;</span></td>
      <td align="right"><span class='chess'>&#x2657;</span></td>
      <td align="right"><span class='chess'>&#x2658;</span></td>
      <td align="right"><span class='chess'>&#x2659;</span></td>
    </tr>
    <tr>
      <td>Normal Chess, Three-check Chess&emsp;</td>
      <td align="right"> 0</td>
      <td align="right"> 9</td>
      <td align="right"> 5</td>
      <td align="right"> 3</td>
      <td align="right"> 3</td>
      <td align="right"> 1</td>
    </tr>
    <tr>
      <td>Crazyhouse Chess, Bughouse Chess&emsp;</td>
      <td align="right"> 0</td>
      <td align="right"> 5</td>
      <td align="right"> 3</td>
      <td align="right"> 3</td>
      <td align="right"> 3</td>
      <td align="right"> 1</td>
    </tr>
    <tr>
      <td>Losers&emsp;</td>
      <td align="right"> 0</td>
      <td align="right"> 5</td>
      <td align="right"> 4</td>
      <td align="right"> 3</td>
      <td align="right"> 4</td>
      <td align="right"> 1</td>
    </tr>
    <tr>
      <td>Suicide, Giveaway&emsp;</td>
      <td align="right">30</td>
      <td align="right"> 3</td>
      <td align="right"> 9</td>
      <td align="right"> 0</td>
      <td align="right"> 9</td>
      <td align="right"> 1</td>
    </tr>
  </table>
</li></ul>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:power</span> a 6)
</code></div>

<p>
This will match positions in which the total power of the black pieces on the
board equals 6.
</p>

<div class='verb'><code>
(position <span class='keyword'>:power</span> A[a-h1-4] 10 25)
</code></div>

<p>
This will match positions in which the total power of the white pieces on the
white half of the board is between 10 and 25 inclusive.
</p>

<h3 id="position:powerdifference">:powerdifference</h3>

<p>
This keyword takes as argument a piece designator followed by a range
specifier. It matches positions in which the difference in power (&#x21d2;
<a href="CQL-Position-List.html#position:power">:power</a>) between the white and black pieces matching the
piece designator (that is, the numeric value of the power of the matching
black pieces subtracted from the power of the matching white pieces) lies
within the range specifier.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:powerdifference</span> U 4)
</code></div>

<p>
This matches positions in which the white pieces have power precisely 4
greater than the black pieces.
</p>

<div class='verb'><code>
(position <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2656;</span><span class='piece'>&#x265c;</span>] -5 10)
</code></div>

<p>
This matches positions in which white has between one fewer and two more
rooks than black.
</p>

<div class='verb'><code>
(position <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2656;</span><span class='piece'>&#x265c;</span><span class='piece'>&#x2657;</span><span class='piece'>&#x265d;</span><span class='piece'>&#x2658;</span><span class='piece'>&#x265e;</span>] unlimited -2)
</code></div>

<p>
This matches positions in which black is up at least an exchange.
</p>

<div class='box'><pre><code><!--
-->(match
  (position
    <a href="CQL-Match-List.html#match:result">:result</a> 1-0
    <a href="CQL-Position-List.html#position:sequence">:sequence</a> (
      (position
        <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] unlimited -9
        <span class='keyword'>:powerdifference</span> U unlimited -9)
      (position <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] unlimited -9)
      (position <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] unlimited -9)
      (position <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] unlimited -9)
      (position <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] unlimited -9)
      (position <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] unlimited -9)
      (position <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] unlimited -9)
      (position <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] unlimited -9)
      (position <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] unlimited -9)
      (position <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] unlimited -9)
      (position <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] unlimited -9)
      (position <span class='keyword'>:powerdifference</span> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] unlimited -9))
    <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>))<!--
--></code></pre></div>

<p>
This example shows how to search for queen sacrifices using
<code>:powerdifference</code>. One side sacrifices a queen, and remains at
least 9 points down in material for at least 12 moves, and then wins.
</p>

<h3 id="position:ray">:ray</h3>

<p>
A ray specifier is a list of piece designators. A ray is a contiguous set of
squares on a straight line on the chessboard parallel to an axis, the a1-h1
diagonal, or the a8-h8 diagonal.
</p>

<p>
Let R by a ray with ordered set of squares in a contiguous line
S&#x2081;, S&#x2082;,...,S&#x2090;. Suppose spec is a ray specifier
(G&#x2081;, G&#x2082;,...,G&#x2093;) where each G&#x2081;,...,G&#x2093;
is a piece designator. The ray R is valid with respect to the ray specifier
if G&#x2081; matches the piece on S&#x2081;, and if G&#x2093; matches the
piece on S&#x2090;, and if the remaining G's can be paired to some subset
of the squares in the ray in an order-preserving way such that each G matches
the piece on its corresponding square and such that all unpaired squares in
the ray are empty.
</p>

<p>
The :ray keyword takes a ray specifier and an optional range
specifier. If the range specifier is absent, it is taken to be
<span style='white-space:nowrap;'><code>1 unlimited</code></span>.  Otherwise, :ray matches a position if the number
of rays in the position valid with respect to the ray specifier lies within
the range specifier.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:ray</span> (<span class='piece'>&#x265a;</span> <span class='piece'>&#x2655;</span>)) 
</code></div>

<p>
Matches a position in which a white queen attacks the black king.
</p>

<div class='verb'><code>
(position <span class='keyword'>:ray</span> (<span class='piece'>&#x2655;</span>a? <span class='piece'>&#x265e;</span> <span class='piece'>&#x265a;</span>[?4-8]))
</code></div>

<p>
Matches a position in which a white queen on the a file pins a black knight
to the black king on the last four ranks.
</p>

<div class='verb'><code>
(position <span class='keyword'>:ray</span> (<span class='piece'>&#x2655;</span>a? <span class='piece'>&#x2655;</span>c? <span class='piece'>&#x2655;</span>e? <span class='piece'>&#x265a;</span>g?))
</code></div>

<p>
Matches a position in which either three queens and the black king are on the
same rank, with exactly one empty square between them, and one of the queens
is on the a-file, or a position in which the three queens and king form a
diagonal with one empty squares between successive pieces and the queens on
the a, c, and e files.
</p>

<div class='verb'><code>
(position <span class='keyword'>:ray</span> (<span class='piece'>&#x2655;</span> <span class='piece'>&#x265e;</span> <span class='piece'>&#x265a;</span>) 2 4)
</code></div>

<p>
Between two and for black knights are pinned to the black king.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:rayattack">:rayattack</a>.
</p>

<h3 id="position:rayattack">:rayattack</h3>

<p>
Has the same syntax as <a href="CQL-Position-List.html#position:ray">:ray</a>. It has the semantics of
<a href="CQL-Position-List.html#position:ray">:ray</a>, except that only orthogonal rays that start on
a square containing a rook or queen are included, and only diagonal rays
starting on a square containing a bishop or queen are included.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:rayattack</span> (A a <span class='piece'>&#x265a;</span>))
</code></div>

<p>
Matches a position in which a black piece is pinned to the black king.
</p>

<div class='verb'><code>
(position <span class='keyword'>:rayattack</span> (Ad5 a [<span class='piece'>&#x265c;</span><span class='piece'>&#x265a;</span>][a-h1-4]) 3)
</code></div>

<p>
Matches positions in which there are three black pinned by a white piece on
d5 against either a black rook or king in the first four ranks.
</p>

<div class='verb'><code>
(position <a href="CQL-Position-List.html#position:stalemate">:stalemate</a> <span class='keyword'>:rayattack</span>
(A a <span class='piece'>&#x265a;</span>) 2 8 <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>)
</code></div>

<p>
Finds multiple-pin stalemates.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:ray">:ray</a>.
</p>

<h3 id="position:raydiagonal">:raydiagonal</h3>

<p>
This keyword function exactly like <a href="CQL-Position-List.html#position:ray">:ray</a> but the given rays
are restricted to being diagonal. A diagonal ray is a ray that is not vertical
or horizontal.
</p>

<h3 id="position:rayhorizontal">:rayhorizontal</h3>

<p>
This keyword function exactly like <a href="CQL-Position-List.html#position:ray">:ray</a> but the given rays
are restricted to being horizontal. A horizontal ray is a ray that is horizontal.
</p>

<h3 id="position:rayorthogonal">:rayorthogonal</h3>

<p>
This keyword function exactly like <a href="CQL-Position-List.html#position:ray">:ray</a> but the given rays
are restricted to being orthogonal. A orthogonal ray is a ray that is not
diagonal.
</p>

<h3 id="position:rayvertical">:rayvertical</h3>

<p>
This keyword function exactly like <a href="CQL-Position-List.html#position:ray">:ray</a> but the given rays
are restricted to being vertical. A vertical ray is a ray that is vertical.
</p>

<h2 id="move">Move keywords</h2>

<p>
In a position, the next move is the move about to be played, if any. A move has
three charactistics: its from designator, its to designator and its promotion
designator. These refer respectively to the piece and square from which the
piece moves; to the piece and square to which it is going to move (but before
it actually moves there), and to the piece and square to which it promotes,
if any.
</p>

<p>
For example, the to designation of a white rook on a4 capturing a black knight
on d4 is <span style='white-space:nowrap;'><code><span class='piece'>&#x265e;</span>d4</code></span>, and its from designation is <span style='white-space:nowrap;'><code><span class='piece'>&#x2656;</span>a4</code></span>. The
to designation of a move to e4 that is not a capture is <span style='white-space:nowrap;'><code>.e4</code></span>. 
</p>

<ul style='list-style-type: none'><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:enpassant">:enpassant</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:iscastling">:iscastling</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:movefrom">:movefrom</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:movenumber">:movenumber</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:moveto">:moveto</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:nocastling">:nocastling</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:noenpassant">:noenpassant</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:nopiecedrop">:nopiecedrop</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:piecedrop">:piecedrop</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:promote">:promote</a></td></tr>
  </table>
</li></ul>

<h3 id="position:enpassant">:enpassant</h3>

<p>
The next move is an en-passant capture.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:noenpassant">:noenpassant</a>
</p>

<h3 id="position:iscastling">:iscastling&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
The next move is a castling move.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:nocastling">:nocastling</a>.
</p>

<h3 id="position:movefrom">:movefrom</h3>

<p>
Takes a single parameter, a piece designator. It matches a move whose from
designator matches that piece designator.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:movefrom</span> <span class='piece'>&#x2656;</span>a3)
</code></div>

<p>
Matches a position in which the next move is of a white rook on a3.
</p>

<div class='verb'><code>
(position <span class='keyword'>:movefrom</span> U?8)
</code></div>

<p>
Matches a position in the next move is of some piece on the 8th rank.
</p>

<h3 id="position:movenumber">:movenumber</h3>

<p>
:movenumber takes a range specifier as parameter and matches positions only
if the current move number is within the specified range. The move number
computation assumes white moves first, and might be one off otherwise.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:movenumber</span> 10 20 <a href="CQL-Position-List.html#position:check">:check</a>)
</code></div>

<p>
Matches a position in which there is a check between moves 10 and 20.
</p>

<div class='verb'><code>
(position <span class='keyword'>:movenumber</span> 35 <a href="CQL-Position-List.html#position:mate">:mate</a>)
</code></div>

<p>
matches a position in which move 35 is mate.
</p>

<h3 id="position:moveto">:moveto</h3>

<p>
Takes a single parameter, a piece designator. It matches a move whose
to designator matches its parameter.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:moveto</span> U)
</code></div>

<p>
Is matching a position where next move is a capture move.
</p>

<div class='verb'><code>
(position <span class='keyword'>:moveto</span> .)
</code></div>

<p>
Is matching a position where next move is not a capture move.
</p>

<div class='verb'><code>
(position <span class='keyword'>:moveto</span> <span class='piece'>&#x2656;</span>[b1-8])
</code></div>

<p>
Matches a position in which the next move is to capture a white rook on
the b file. Note that this is quite different from the natural
<a href="http://de.wikipedia.org/wiki/Portable_Game_Notation">PGN<span class="awesome">&nbsp;&#xf08e;</span></a>
interpration of its being a move of a white rook to the b file. That
would be done via:
</p>

<div class='verb'><code>
(position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span> <span class='keyword'>:moveto</span> ?b?)
</code></div>

<p>
Matches a move of the white rook to the b file.
</p>

<h3 id="position:nocastling">:nocastling&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
The next move is not a castling move.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:iscastling">:iscastling</a>.
</p>

<h3 id="position:noenpassant">:noenpassant</h3>

<p>
The next move is not an en-passant capture.
</p>

<p>
See also: <a href="CQL-Position-List.html#position:enpassant">:enpassant</a>.
</p>

<h3 id="position:piecedrop">:piecedrop&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
The next move is a piece drop, if dropping a piece matching the
given piece designator (possible only in chess variants
Crazyhouse Chess, and Bughouse Chess).
</p>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:piecedrop</span> [<span class='piece'>&#x2658;</span><span class='piece'>&#x265e;</span>])
</code></div>

<p>
The next move is a piece drop which is dropping a knight.
</p>

<div class='verb'><code>
(position <span class='keyword'>:piecedrop</span> [])
</code></div>

<p>
The next move is not a piece drop (because the piece designator
is empty).
</p>

<h3 id="position:promote">:promote</h3>

<p>
Takes a single parameter, a piece designator. It matches a move if that move
is a promotion whose promotion designator matches its parameter.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:promote</span> [<span class='piece'>&#x2656;</span><span class='piece'>&#x2657;</span><span class='piece'>&#x2658;</span>])
</code></div>

<p>
Matches a position whose next move is a white underpromotion.
</p>

<div class='verb'><code>
(position <span class='keyword'>:promote</span> [<span class='piece'>&#x2657;</span><span class='piece'>&#x2658;</span>]a8)
</code></div>

<p>
Matches a position whose next move is a white promotion to bishop or knight.
</p>

<div class='verb'><code>
(position <span class='keyword'>:promote</span> [<span class='piece'>&#x2656;</span>e8]
<a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2659;</span>f7 <a href="CQL-Position-List.html#position:moveto">:moveto</a> <span class='piece'>&#x265b;</span>)
</code></div>

<p>
Matches a position in which the next move is of a pawn on f7 capturing a black
queen on e8 and promoting to a rook.
</p>

<div class='verb'><code>
(position <span class='keyword'>:promote</span> [])
</code></div>

<p>
Matches a position in which the next move is not a promotion (because the
piece designator is empty).
</p>

<h2 id="sequence">Sequence keywords</h2>

<ul style='list-style-type: none'><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:gappedsequence">:gappedsequence</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:sequence">:sequence</a></td></tr>
  </table>
</li></ul>

<h3 id="position:gappedsequence">:gappedsequence</h3>

<p>
Takes one argument, a list of position lists. A position list A is said to be
a refinement of a position list B if A may be formed from B by inserting zero or
more position lists of the form (position) into the top level of B. For
example:
</p>

<div class='verb'><code>
((position <span class='piece'>&#x2658;</span>a4) (position) (position <span class='piece'>&#x2656;</span>b2))
</code></div>

<p>
refines
</p>

<div class='verb'><code>
((position <span class='piece'>&#x2658;</span>a4) (position <span class='piece'>&#x2656;</span>b2))
</code></div>

<p>
because it was formed by inserting a single position list into the latter list.
</p>

<p>
A :gappedsequence with argument B matches a position if and only if there is a
refinement A of B such that a <a href="CQL-Position-List.html#position:sequence">:sequence</a> with argument A
would match that position. That is, :gappedsequence is like
<a href="CQL-Position-List.html#position:sequence">:sequence</a> except that the sequence of matching positions
may include intervening positions from the game.
</p>

<p>
Examples:
</p>

<div class='box'><pre><code><!--
-->(position
  <span class='keyword'>:gappedsequence</span> (
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span>a3)
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span>b4)))<!--
--></code></pre></div>

<p>
This will match any position for which the positions that occur successively
in the game starting with that position comprise zero or more positions,
followed by a position from which a white rook on a3 moves, followed by zero
or more positions, followed by a position from which a white rook on b4 moves.
In consequence the same effect can be obtained much more efficiently via:
</p>

<div class='box'><pre><code><!--
-->(position 
  <a href="CQL-Position-List.html#position:initial">:initial</a>
  <span class='keyword'>:gappedsequence</span> (
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span>a3)
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span>b4)))<!--
--></code></pre></div>

<p>
The following position list matches a position in which a knight is on d4 at
some point in the game after that position:
</p>

<div class='box'><pre><code><!--
-->(position
  <span class='keyword'>:gappedsequence</span> (
    (position)
    (position <span class='piece'>&#x2658;</span>d4))) <!--
--></code></pre></div>

<p>
Note that the first element of the argument to :gappedsequence,
<span style='white-space:nowrap;'><code>(position)</code></span>, is used to ensure that only knights on d4 in
positions that occur after the position to be matched are considered.
</p>

<p>
This fragment is used here, to find all games in which some knight has
visited at least twenty different squares.
</p>

<p>
The total number of <a href="CQL-Position-List.html#position:sequence">:sequence</a> and :gappedsequence position
lists that can occur at the top level of a position list cannot exceed one. To
get the effect of both a :gappedequence and <a href="CQL-Position-List.html#position:sequence">:sequence</a>
keywords in one position list, use <a href="CQL-Position-List.html#position:and">:and</a>.
</p>

<h3 id="position:sequence">:sequence</h3>

<p>
Takes a single argument that is a list of position lists. It matches a given
position if and only successive occurring positions, beginning with the
current position, match each corresponding element in its argument.
</p>

<p>
Example:
</p>

<div class='box'><pre><code><!--
-->(position
  <span class='piece'>&#x2656;</span>e8 
  <span class='keyword'>:sequence</span> (
    (position <span class='piece'>&#x2655;</span>f3 .g2)
    (position .f3 <span class='piece'>&#x2655;</span>g2)))<!--
--></code></pre></div>

This position list matches exactly those positions with a white rook on e8
such that:

<ol>
  <li>In that position, white has a queen on f3 and g2 is empty, and</li>
  <li>After the next move, f3 is empty and there is a white queen on g2.</li>
</ol>

<p>
In consequence, this position list is identical in effect to
</p>

<div class='verb'><code>
(position <span class='piece'>&#x2656;</span>e8 <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2655;</span>f3 <a href="CQL-Position-List.html#position:moveto">:moveto</a> .g2)
</code></div>

<p>
The following more typical usage of :sequence will search for all queen
staircase checking maneuvers by either side:
</p>

<div class='box'><pre><code><!--
-->(position 
  <a href="CQL-Position-List.html#position:shift">:shift</a> <a href="CQL-Position-List.html#position:flip">:flip</a> <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>
  <span class='keyword'>:sequence</span> (
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2655;</span>a2) 
    (position <a href="CQL-Position-List.html#position:check">:check</a>) 
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2655;</span>b2) 
    (position <a href="CQL-Position-List.html#position:check">:check</a>) 
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2655;</span>b3) 
    (position <a href="CQL-Position-List.html#position:check">:check</a>) 
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2655;</span>c3)
    (position <a href="CQL-Position-List.html#position:check">:check</a>)
    (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2655;</span>c4)))<!--
--></code></pre></div>

<p>
This position list matches any position with a white queen on a2 for which
there are successively moves by queens on the indicated squares giving check;
the <a href="CQL-Position-List.html#position:shift">:shift</a>, <a href="CQL-Position-List.html#position:flip">:flip</a>, and
<a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a> search for this variation reflected or
rotated anywhere on the board.
</p>

<h2 id="game">Game related keywords</h2>

<p>
Several keywords relate to the game parameters and are not affected by the
contents of the position; they are included as position list keywords instead
of match list keywords so the <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a> can be used with
them. these are:
</p>

<ul style='list-style-type: none'><li>
  <table>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:elo">:elo</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:whiteelo">:whiteelo</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:blackelo">:blackelo</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:rating">:rating</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:whiterating">:whiterating</a></td>
      <td>&emsp;&#x2022;</td><td><a href="#position:blackrating">:blackrating</a></td>
    </tr>
    <tr>
      <td>      &#x2022;</td><td><a href="#position:result">:result</a></td>
    </tr>
  </table>
</li></ul>

<h3 id="position:blackelo">:blackelo</h3>

<p>
This parameter takes a range specifier; the ELO of the black player must lie
within its range (&#x21d2; <a href="CQL-Range-Specifiers.html">range specifiers</a>).
</p>

<h3 id="position:blackrating">:blackrating&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
Match all games where the specified rating score of black player is between
given range.  For a detailed description see <a href="CQL-Match-List.html#match:rating">:rating (match)</a>.
</p>

<h3 id="position:elo">:elo</h3>

<p>
This parameter expects a range specifer; the ELO of at least one of the
players must lie within the specified range (&#x21d2;
<a href="CQL-Range-Specifiers.html">range specifiers</a>)
</p>

<h3 id="position:rating">:rating&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
Match all games where the specified rating score of one player is between
given range.  For a detailed description see <a href="CQL-Match-List.html#match:rating">:rating (match)</a>.
</p>

<h3 id="position:result">:result</h3>

<p>
This keyword takes one argument, the same as the argument to
<a href="CQL-Match-List.html#match:result">:result (match)</a> in a match list.
</p>

<p>
Example:
</p>

<div class='box'><pre><code><!--
-->(position 
  <span class='keyword'>:result</span> 1-0 
  <a href="CQL-Position-List.html#position:whiteelo">:whiteelo</a> 0 2300
  <a href="CQL-Position-List.html#position:blackelo">:blackelo</a> 2600 3000
  <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>)<!--
--></code></pre></div>

<p>
Searches for positions in which a 2300 player or below defeated a 2600 player
or above.
</p>

<h3 id="position:whiteelo">:whiteelo</h3>

<p>
This parameter takes a range specifier; the ELO of the white player must lie
within its range (&#x21d2; <a href="CQL-Range-Specifiers.html">range specifiers</a>).
</p>

<h3 id="position:whiterating">:whiterating&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
Match all games where the specified rating score of white player is between
given range.  For a detailed description see <a href="CQL-Match-List.html#match:rating">:rating (match)</a>.
</p>

<h2 id="relation">Relation between positions</h2>

<ul style='list-style-type: none'><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:relation">:relation</a></td></tr>
  </table>
</li></ul>

<h3 id="position:relation">:relation</h3>

<p>
Takes one argument, a relation specification. is used to search for games with
pairs of positions P1 and P2 that satisfy certain properties. See
<a href="CQL-Relation-List.html">relation list</a> for a desription of
the relation specification keywords.
</p>

<h2 id="matching">Matching count keywords</h2>

<p>
Two keywords pertain to the number of positions which a position list matches.
These each take a range specifier as parameter. They can only be used in a
position list at the top level of a match list.
</p>

<ul style='list-style-type: none'><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:matchcount">:matchcount</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:pretransformmatchcount">:pretransformmatchcount</a></td></tr>
  </table>
</li></ul>

<h3 id="position:matchcount">:matchcount</h3>

<p>
Matches if and only if the number of times this position list matches a
position in the current game lies within the range specifier.
</p>

<p>
Example:
</p>

<div class='verb'><code>
(position <a href="CQL-Position-List.html#position:moveto">:moveto</a> [<span class='piece'>&#x2655;</span><span class='piece'>&#x265b;</span>] <span class='keyword'>:matchcount</span> 4 100)
</code></div>

<p>
Matches any game in which at least four queen captures have occurred.
</p>

<h3 id="position:pretransformmatchcount">:pretransformmatchcount</h3>

<p>
Has the same syntax as <a href="CQL-Position-List.html#position:matchcount">:matchcount</a>. It matches a position if
and only if there is some transform in the transformation set associated with
the position list in which it occurs such that, were the position list
replaced by a new position list formed from the first by deleting all
transformation keywords, applying the transform to that position list, and
changing this keyword to <a href="CQL-Position-List.html#position:matchcount">:matchcount</a>, then the position
list would match the position.
</p>

<p>
Example:
</p>

<div class='box'><pre><code><!--
-->(position
  <a href="CQL-Position-List.html#position:movetoy">:movetoy</a> [Aa]d4 
  <span class='keyword'>:pretransformmatchcount</span> 12 unlimited
  <a href="CQL-Position-List.html#position:shift">:shift</a>))<!--
--></code></pre></div>

<p>
This would match any game in which at least 12 captures occur on the same
square. Were the :pretransformmatchcount replaced by
<a href="CQL-Position-List.html#position:matchcount">:matchcount</a>, the position list would match games in which
at least 12 captures occurred.
</p>

<h2 id="evaluation">Analyzing keywords</h2>

<p>
The following keywords are analyzing positions. <a href="CQL-Position-List.html#position:evaluation">:evaluation</a> and
<a href="CQL-Position-List.html#position:moveevaluation">:moveevaluation</a> should be used with care, these are very slow
operations. In some cases the keywords <a href="CQL-Position-List.html#position:exchangeevaluation">:exchangeevaluation</a> and
<a href="CQL-Position-List.html#position:maxswapevaluation">:maxswapevaluation</a> might be an alternative, these functions are
quite faster, although quite time consuming.
</p>

<ul style='list-style-type: none'><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:evaluation">:evaluation</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:exchangeevaluation">:exchangeevaluation</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:maxswapevaluation">:maxswapevaluation</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:moveevaluation">:moveevaluation</a></td></tr>
  </table>
</li></ul>

<h3 id="position:evaluation">:evaluation&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<div class='annotation'><img src='../images/annotation.png' style='float:left; margin:0 1em 0 0' alt='annotation' />
This is a very slow operation and should be restricted.
</div>

<p>
This keyword is evaluating the current position with the help of an
external chess engine. The number of parameters depends on the search mode.
There are three search modes:
</p>

<ul style='list-style-type: none'><li>
  <table>
    <!-- UCI:  "go depth <x>" -->
    <!-- WB:   "st <x>"       -->
    <tr>
      <td class="l"><span style='white-space:nowrap;'><code>depth &lt;d&gt;</code></span></td>
      <td class="r">search &lt;d&gt; plies only</td>
    </tr>

    <!-- UCI:  "go movetime <x>" -->
    <tr>
      <td class="l"><span style='white-space:nowrap;'><code>movetime &lt;ms&gt;</code></span></td>
      <td class="r">search exactly &lt;ms&gt; milli-seconds per move</td>
    </tr>

    <!-- UCI:  "go mate <x>" -->
    <tr>
      <td class="l"><span style='white-space:nowrap;'><code>mate &lt;n&gt;</code></span></td>
      <td class="r">search for a mate in &lt;n&gt; moves</td>
    </tr>
  </table>
</li></ul>

<p>
The modes "depth" and "movetime" are taking three additional parameters.
The third parameter denotes the lower bound, the fourth parameter
denotes the upper bound, both scores are in centi-pawns. The query succeeds
if the estimation is within the specified bounds (inclusive the ranges). If
the lower-bound value is specified with <i>unlimited</i>, it means negative
unlimited. If the upper-bound value is specified with <i>unlimited</i>, it means
positive unlimited. The fifth parameter is either <i>sidetomove</i> or <i>absolute</i>.
<i>sidetomove</i> means that the evaluation value depends on side to move, and
<i>absolute</i> means that the evaluation value is independent from side to move.
</p>

<p><img src='../images/note.png' alt='note' /> 
Please note that the modes "depth" and "mate" are available only if the engine
supports the UCI protocol. An engine restricted to the WinBoard/XBoard protocol
does only support the "movetime" mode.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
<span class='keyword'>:evaluate</span> depth 4 2.5 unlimited sidetomove
</code></div>

<p>
Side to move has (possibly) a winning position, because he is
at least 2.5 pawn units ahead.
</p>

<div class='verb'><code>
<span class='keyword'>:evaluate</span> depth 4 unlimited -2.5 sidetomove
</code></div>

<p>
Side to move has (possibly) a losing position, because he is
at least 2.5 pawn units behind.
</p>

<div class='verb'><code>
<span class='keyword'>:evaluate</span> movetime 3000 unlimited -3.0 absolute
</code></div>

<p>
Black is (possibly) losing, because he is at least 3 pawn units behind.
</p>

<div class='verb'><code>
<span class='keyword'>:evaluate</span> mate 3
</code></div>

<p>
Either side is mate in maximal 3 moves.
</p>

<h3 id="position:exchangeevaluation">:exchangeevaluation&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
This keyword is analyzing capture moves to see whether or not they appear
to be profitable.
</p>

<p>
The keyword match the current move if this value is in the specified range
(a lower and an upper value). Only capture moves will be evaluated.
If lower range is specified with <i>unlimited</i>, it means negative unlimited.
If the lower range is specified with <i>unlimited</i>, it means positive unlimited.
The exchange function is taking into account that exchanged pieces may be
pinned or defended by other pieces. The value of the function does not depend
on which side is to move.
</p>

<p>
Concerning the piece values see <a href="CQL-Position-List.html#position:power">:power</a>.
</p>

<p>
Note that this function is not evaluating the position, instead it is
estimating the exchange values.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
<span class='keyword'>:exchangeevaluation</span> unlimited 3
</code></div>

<p>
This move is (possibly) a blunder.
</p>

<h3 id="position:maxswapevaluation">:maxswapevaluation&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
This keyword allows to estimate exchange values of possible moves. It takes
as arguments two piece designators followed by a range specifier. The first
argument specifies moving pieces, the second one specifies target squares.
For each possible moves we compute an integer value that is a material benefit
of the move (in pawns, like in case of the <a href="CQL-Position-List.html#position:power">:power</a> keyword)
according to possible piece exchanges on the target square after the move.
After that the maximum of all computed values will be selected.
</p>

<p>
The keyword match the position if this value lies in the specified range
(a lower and an upper value). If lower range is specified with <i>unlimited</i>,
it means negative unlimited. If the lower range is specified with <i>unlimited</i>,
it means positive unlimited. The exchange function is taking into account that
exchanged pieces may be pinned or defended by other pieces. The value of the
function does not depend on which side is to move.
</p>

<p>
Note that this function is not evaluating the position, instead it is
estimating the exchange values.
</p>

<p>
Concerning the piece values see <a href="CQL-Position-List.html#position:power">:power</a>.
</p>

<p><img src='../images/note.png' alt='note' /> 
This keyword is alike the keyword <span style='white-space:nowrap;'><code>:maxswapvalue</code></span> from Chess
Assistant 9 (&#x21d2;
<a href="http://hornid.com/chess/docs/CQL-3GX.pdf">The CQL 3.GX Extension<span class="awesome">&nbsp;&#xf08e;</span></a>),
but quite different implemented.
</p>

<p>
Examples:
</p>

<div class='verb'><code>
(position <span class='keyword'>:maxswapevaluation</span> A a 1 unlimited)
</code></div>

<p>
This query selects positions in which white threatens with
winning some material:
</p>

<div class='verb'><code>
(position <span class='keyword'>:maxswapevaluation</span> <span class='piece'>&#x2655;</span>?1-7 ??8 0 unlimited)
</code></div>

<p>
This query selects positions in which a white queen can invade rank 8
without a material loss.
</p>

<h3 id="position:moveevaluation">:moveevaluation&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<div class='annotation'><img src='../images/annotation.png' style='float:left; margin:0 1em 0 0' alt='annotation' />
This is a very slow operation and should be restricted.
</div>

<p>
This keyword is matching the difference between the evaluation of the current
position and the evaluation of the preceding position. The evaluation will be
done with the help of an external chess engine. It takes seven parameters.
The first and second parameter are piece designators. The former is specifies
moving pieces, the second one specifies target squares.  The third and fourth
are depending on the search mode:
</p>

<ul style='list-style-type: none'><li>
  <table>
    <!-- UCI:  "go depth <x>" -->
    <tr>
      <td class="l"><span style='white-space:nowrap;'><code>depth &lt;d&gt;</code></span></td>
      <td class="r">search &lt;d&gt; plies only</td>
    </tr>

    <!-- UCI:  "go movetime <x>" -->
    <!-- WB:   "st <x>"       -->
    <tr>
      <td class="l"><span style='white-space:nowrap;'><code>movetime &lt;ms&gt;</code></span></td>
      <td class="r">search exactly &lt;ms&gt; milli-seconds per move</td>
    </tr>
  </table>
</li></ul>

<p>
The fifth parameter denotes the lower bound score, the sixth parameter denotes
the upper bound score, both scores are in centi-pawns. If the lower-bound value
is specified with <i>unlimited</i>, it means negative unlimited. If the upper-bound
value is specified with <i>unlimited</i>, it means positive unlimited. The query
succeeds if the scoring of this move is within the given bounds (inclusive the
ranges). The score of this move is the difference between the score of the
current board and the score of the last board. In case of mating positions
the difference will be always greater than 10.000.
</p>

<p><img src='../images/note.png' alt='note' /> 
Please note that the mode "depth" is available only if the engine suppoprts the
UCI protocol. An engine restricted to the WinBoard/XBoard protocol does only
support the "movetime" mode.
</p>

<p>
The seventh parameter is either <i>sidetomove</i> or <i>absolute</i>.
<i>sidetomove</i> means that the evaluation value depends on side to move, and
<i>absolute</i> means that the evaluation value is independent from side to move.
</p>

<p>
Example:
</p>

<div class='verb'><code>
<span class='keyword'>:moveevaluation</span> U ? depth 4 3.0 unlimited sidetomove
</code></div>

<p>
Match first position were the evaluation score is at least 3.0 pawn units.
This means that last move was (possibly) a blunder.
</p>

<div class='verb'><code>
<span class='keyword'>:moveevaluation</span> A a depth 4 unlimited -3.0 absolute
</code></div>

<p>
Match first position were the evaluation score is at least 3.0 pawn units
better for black. This means that last white move was (possibly) a blunder.
Only capture moves will be evaluated.
</p>

<div class='box'><pre><code><!--
-->(match
  (position <span class='keyword'>:moveevaluation</span> [<span class='piece'>&#x2659;</span><span class='piece'>&#x265f;</span>] ?[a-h1,a-h8]
             unlimited 0.0 movetime 5000 absolute)
  (position <a href="CQL-Position-List.html#position:promotion">:promotion</a> U <a href="CQL-Position-List.html#position:cut">:cut</a>)))<!--
--></code></pre></div>

<p>
Search for positions where side to move is doing first promotion in game, but
without gaining a better score. We are ensuring that only promoting moves will
be evaluated.
</p>

<h2 id="accumulator">Accumulator keywords</h2>

<p>
There are mainly two accumulator keywords, :accumulate and :sumrange. These
are used to accumulate and to test the number of transforms of the enclosing
position list that match the current position. Each time a transform of a
position list matches a position, the accumulator associated with that position
is incremented. Any position with a sum range can then test if the accumulator
is within a certain range.
</p>

<ul style='list-style-type: none'><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:accumulate">:accumulate</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:reset">:reset</a></td></tr>
    <tr><td>&#x2022;</td><td><a href="#position:sumrange">:sumrange</a></td></tr>
  </table>
</li></ul>

<h3 id="position:accumulate">:accumulate</h3>

<p>
This takes one parameter, the name of an accumulator. Each time the application
of some element of the transform set of the position list matches a position,
the accumulator associated with this name is incremented. The accumulator is
cleared when a new position is reached (and in consequence :accumulate should
not be used inside of <a href="CQL-Position-List.html#position:not">:not</a>, or the
<a href="CQL-Position-List.html#position:sequence">:sequence</a>, and <a href="CQL-Position-List.html#position:gappedsequence">:gappedsequence</a> keywords).
This keyword inhibits short-circuiting of logical keywords
<a href="CQL-Position-List.html#position:and">:and</a>, and <a href="CQL-Position-List.html#position:or">:or</a>. Note that
<a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a> likely has unexpected results when used with
:accumulate, because the accumulator is not cleared between color flips.
</p>

<p>
For examples see:
<a href="CQL-Examples.html#accumulator">Using accumulators to count passed pawns</a>.
</p>

<h3 id="position:reset">:reset&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
This keyword takes as a parameter the name of an accumulator. It clears the
accumulator associated with this name after applying a transformation.
</p>

<p>
Example:
</p>

<p>
Tripled pawns can be found by the query:
</p>

<div class='box'><pre><code><!--
-->(position
  <span class='keyword'>:reset</span> acc
  <span class='piece'>&#x2659;</span>e2
  <a href="CQL-Position-List.html#position:accumulate">:accumulate</a> acc
  <a href="CQL-Position-List.html#position:sumrange">:sumrange</a> acc 3
  <a href="CQL-Position-List.html#position:shiftvertical">:shiftvertical</a>
  <a href="CQL-Position-List.html#position:shifthorizontal">:shifthorizontal</a>)<!--
--></code></pre></div>

<p>
Note that this is only an example for this keyword (taken from
<a href="http://hornid.com/chess/docs/CQL-3GX.pdf">The CQL 3.GX Extension<span class="awesome">&nbsp;&#xf08e;</span></a>),
it is not recommended to use this statement for triple pawn search.
A much better way is:
</p>

<div class='box'><pre><code><!--
-->(position
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x2659;</span>a[3-7] 3 6
  <a href="CQL-Position-List.html#position:shifthorizontal">:shifthorizontal</a>
  <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>))<!--
--></code></pre></div>

<h3 id="position:sumrange">:sumrange&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
This takes as parameter the name of an accumulator and a range specifer.
It matches a position if the value of the given accumulator lies within
the range specifier.
</p>

<p>
For examples see:
<a href="CQL-Examples.html#accumulator">Using accumulators to count passed pawns</a>.
</p>

<h2 id="tagging">Tagging keywords</h2>

<ul style='list-style-type: none'><li>
  <table>
    <tr><td>&#x2022;</td><td><a href="#position:tagmatch">:tagmatch</a></td></tr>
  </table>
</li></ul>

<h3 id="position:tagmatch">:tagmatch&ensp;<img src="../images/ft-scidb-tiny.png" alt="" /> </h3>

<p>
The :tagmatch keyword takes two parameters, the name of a tag and a piece
designator. It matches only if the piece corresonding to the named tag
matches the given piece designator. For more information, see the section
on <a href="CQL-Tagging.html">tagging</a>.
</p>

</body>
</html>
