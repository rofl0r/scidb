<?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated from tcl/help/en/CQL-Examples.txt -->

<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<head>
  <meta http-equiv="content-type"
           content="text/html; charset=utf-8" />
  <meta http-equiv="content-language"
           content="en" />
  <meta http-equiv="content-style-type"
           content="text/css" />

  <meta name="author"
     content="scidb.sourceforge.net" />
  <meta name="generator"
     content="scidb.sourceforge.net" />
  <meta name="description"
     content="Scidb Help Page" />

  <link rel="icon"
       href="http://scidb.sourceforge.net/images/scidb.ico"
       type="image/x-icon" />
  <link rel="shortcut icon"
       href="http://scidb.sourceforge.net/images/scidb.ico" />
  <link rel="stylesheet"
       type="text/css"
      media="screen"
       href="../styles/help.css" />

  <title>Scidb Help: CQL - Examples</title>
</head>

<body>

<div class="title">
  <h1 class="title">CQL - Examples</h1>
</div>

<ul>
  <li><a href="#accumulator">Using accumulators to count passed pawns</a></li>
  <li><a href="#relation">Relation list example</a></li>
  <li><a href="#tagging">Examples for tagging</a></li>
  <li><a href="#more">More examples</a></li>
</ul>

<h2 id="accumulator">Using accumulators to count passed pawns</h2>

<p>
We will show how to use <a href="CQL-Position-List.html#position:accumulate">:accumulate</a> and
<a href="CQL-Position-List.html#position:sumrange">:sumrange</a> to look for games that have at least 3 white
passed pawns in a position. First, we give a position filter that will
match any position with a white passed pawn:
</p>

<div class='box'><pre><code><!--
--><span class='comment'>; match a position with a white passed pawn</span>
(position
  <span class='piece'>&#x2659;</span>d2
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x265f;</span><span class='piece'>&#x2659;</span>][d3-7] 0
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x265f;</span>[c3-7,e3-7] 0
  <a href="CQL-Position-List.html#position:shift">:shift</a>)<!--
--></code></pre></div>

<p>
Now, to find at least 3 white passed pawns, we add in some accumulation code:
</p>

<div class='box'><pre><code><!--
--><span class='comment'>; match a position with at least three white passed pawns</span>
(position
  <span class='piece'>&#x2659;</span>d2
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x265f;</span><span class='piece'>&#x2659;</span>][d3-7] 0
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x265f;</span>[c3-7,e3-7] 0
  <a href="CQL-Position-List.html#position:shift">:shift</a>
  <a href="CQL-Position-List.html#position:accumulate">:accumulate</a> white_passer_counter
  <a href="CQL-Position-List.html#position:sumrange">:sumrange</a> white_passer_counter 3 8)<!--
--></code></pre></div>

<p>
Now suppose we want to find positions with at least two black passed pawns.
We can use:
</p>

<div class='box'><pre><code><!--
--><span class='comment'>;match a position with at least two black passed pawns</span>
(position
  <span class='piece'>&#x265f;</span>d7 
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x265f;</span><span class='piece'>&#x2659;</span>][d2-6] 0
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x2659;</span>[c2-6,e2-6] 0
  <a href="CQL-Position-List.html#position:shift">:shift</a>
  <a href="CQL-Position-List.html#position:accumulate">:accumulate</a> black_passer_counter
  <a href="CQL-Position-List.html#position:sumrange">:sumrange</a> black_passer_counter 2 8)<!--
--></code></pre></div>

<p>
Finally, to find positions with at least two black passers and at least three
white passers, we combine these lists:
</p>

<div class='box'><pre><code><!--
--><span class='comment'>; match a position with at least three white</span>
<span class='comment'>; and at least two black passers</span>
(position
  <a href="CQL-Position-List.html#position:sumrange">:sumrange</a> white_passer_counter 3 8 
  <a href="CQL-Position-List.html#position:sumrange">:sumrange</a> black_passer_counter 2 8
  <a href="CQL-Position-List.html#position:and">:and</a> (
    (position
      <span class='piece'>&#x2659;</span>d2 
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x265f;</span><span class='piece'>&#x2659;</span>][d3-7] 0
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x265f;</span>[c3-7,e3-7] 0
      <a href="CQL-Position-List.html#position:shift">:shift</a>
      <a href="CQL-Position-List.html#position:accumulate">:accumulate</a> white_passer_counter)
    (position
      <span class='piece'>&#x265f;</span>d7 
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x265f;</span><span class='piece'>&#x2659;</span>][d2-6] 0
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x2659;</span>[c2-6,e2-6] 0
      <a href="CQL-Position-List.html#position:shift">:shift</a>
      <a href="CQL-Position-List.html#position:accumulate">:accumulate</a> black_passer_counter)))<!--
--></code></pre></div>

<h2 id="relation">Relation list example</h2>

<p>
The following position list searches for games in which the configuration
</p>

<ul style='list-style-type: none'><li><code>
<span class='piece'>&#x2654;</span>e6 <span class='piece'>&#x265d;</span>e7 <span class='piece'>&#x265d;</span>e4 <span class='piece'>&#x265e;</span>d5
</code></li></ul>

<p>
occurs shifted or flipped, but in which no pieces from the original position
are on the same square as the pattern:
</p>

<div class='box'><pre><code><!--
-->(position
  <span class='piece'>&#x2654;</span>e6 <span class='piece'>&#x265d;</span>e7 <span class='piece'>&#x265d;</span>e4 <span class='piece'>&#x265e;</span>d5
  <a href="CQL-Position-List.html#position:shift">:shift</a>
  <a href="CQL-Position-List.html#position:flip">:flip</a>
  <a href="CQL-Position-List.html#position:relation">:relation</a> (
    <a href="CQL-Relation-List.html#relation:pattern">:pattern</a>
    <a href="CQL-Relation-List.html#relation:shift">:shift</a>
    <a href="CQL-Relation-List.html#relation:flip">:flip</a>
    <a href="CQL-Relation-List.html#relation:originalsamecount">:originalsamecount</a> 0
    <a href="CQL-Relation-List.html#relation:samesidetomove">:samesidetomove</a>
    <a href="CQL-Relation-List.html#relation:variations">:variations</a>))<!--
--></code></pre></div>

<p>
If one modified the <a href="CQL-Relation-List.html#relation:originalsamecount">:originalsamecount</a> parameter to, say,
<span style='white-space:nowrap;'><code>0 3</code></span> from its current value of 0, then it would be allowed to
overlap with at most three squares of the pattern in the original position.
</p>

<h2 id="tagging">Examples for tagging</h2>

<p>
Consider the problem of recognizing all games in which the same rook visits all
four corners of the board:
</p>

<div class='box'><pre><code><!--
-->(match
  <a href="CQL-Match-List.html#match:forany">:forany</a> rook [<span class='piece'>&#x265c;</span><span class='piece'>&#x2656;</span>] <span class='comment'>; loop over the possible rooks</span>
  (position $rook[a1]) 
  (position $rook[h1])
  (position $rook[h8])
  (position $rook[a8]))<!--
--></code></pre></div>

<p>
Here, the <a href="CQL-Position-List.html#position:forany">:forany</a> keyword in the match list introduces a tag named
"rook" which is constrained to range over white or black rooks, or over pawns that
eventually promote to one of those.
</p>

<p>
The first position list matches games in which there is a position such that the
tag "rook" represents a rook on a1. The next position list matches games in which
there is a position such that the tag represents a rook on h1. The tag represents
the same mark, that is, the same piece, between the position lists. The
<a href="CQL-Position-List.html#position:forany">:forany</a> keyword will sequentially bind the tag to each allowed mark.
</p>

<p>
Since a match list matches a game only if all its constituent position filters
match it, the code does what we want here.
</p>

<p>
Second example, the excelsior theme: a pawn starts at the second rank and then
promotes.
</p>

<div class='box'><pre><code><!--
-->(match
  <a href="CQL-Match-List.html#match:forany">:forany</a> pawn [<span class='piece'>&#x2659;</span><span class='piece'>&#x265f;</span>]
  (position
    <a href="CQL-Position-List.html#position:initial">:initial</a>
    <a href="CQL-Position-List.html#position:tagmatch">:tagmatch</a> pawn <span class='piece'>&#x2659;</span>?2
    <a href="CQL-Position-List.html#position:gappedsequence">:gappedsequence</a> ((position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> $pawn <a href="CQL-Position-List.html#position:promote">:promote</a> U))
    <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>))<!--
--></code></pre></div>

<p>
<a href="CQL-Position-List.html#position:tagmatch">:tagmatch</a> is matching pawns on second rank, and
the position sequence of <a href="CQL-Position-List.html#position:gappedsequence">:gappedsequence</a> is matching if
the tagged "pawn" is promoting in any subsequent game position.
</p>

<p>
Third example: the same piece delivers at least 30 checks in the game.
</p>

<div class='box'><pre><code><!--
-->(match
  <a href="CQL-Match-List.html#match:forany">:forany</a> checker A
  (position
    <a href="CQL-Position-List.html#position:btm">:btm</a>
    <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> $checker <span class='piece'>&#x265a;</span> 1
    <a href="CQL-Position-List.html#position:matchcount">:matchcount</a> 30 unlimited
    <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>))<!--
--></code></pre></div>

<p>
Fourth example: knight gives mate with its first move.
</p>

<div class='box'><pre><code><!--
-->(match
  <a href="CQL-Match-List.html#match:forany">:forany</a> knight <span class='piece'>&#x2658;</span>
  (position
    <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> $knight
    <a href="CQL-Position-List.html#position:matchcount">:matchcount</a> 1)
  (position
    <a href="CQL-Position-List.html#position:mate">:mate</a>
    <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> $knight <span class='piece'>&#x265a;</span> 1)) <!--
--></code></pre></div>

<h2 id="more">More examples</h2>

<div class='box'><pre><code><!--
--><span class='comment'>; Match isolated triple pawns on connected squares</span>
<span class='comment'>; Example: 8/p4pk1/8/2R1P1N1/6P1/6P1/2P2KP1/1r5r w - - 0 1</span>

(match
  (position
    <span class='piece'>&#x2659;</span>[c2-4]                <span class='comment'>; pawns on connected squares</span>
    <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x2659;</span>c? 3 6    <span class='comment'>; at least three pawns </span>
    <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x2659;</span>[b?,d?] 0 <span class='comment'>; the triple pawns are isolated</span>
    <a href="CQL-Position-List.html#position:shiftvertical">:shiftvertical</a>         <span class='comment'>; any rank</span>
    <a href="CQL-Position-List.html#position:shifthorizontal">:shifthorizontal</a>       <span class='comment'>; any file</span>
    <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>))           <span class='comment'>; any side</span><!--
--></code></pre></div>

<div class='box'><pre><code><!--
--><span class='comment'>; Multiple consecutive rook checks followed by king moving to</span>
<span class='comment'>; empty square; usually to avoid stalemate if rook is captured.</span>

(match
  <a href="CQL-Match-List.html#match:result">:result</a> 1/2
  (position 
    <a href="CQL-Position-List.html#position:wtm">:wtm</a>
    <a href="CQL-Position-List.html#position:sequence">:sequence</a> (  
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span> <a href="CQL-Position-List.html#position:moveto">:moveto</a> .)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x265a;</span> <a href="CQL-Position-List.html#position:check">:check</a>)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span> <a href="CQL-Position-List.html#position:moveto">:moveto</a> .)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x265a;</span> <a href="CQL-Position-List.html#position:check">:check</a>)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span> <a href="CQL-Position-List.html#position:moveto">:moveto</a> .)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x265a;</span> <a href="CQL-Position-List.html#position:check">:check</a>)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span> <a href="CQL-Position-List.html#position:moveto">:moveto</a> .)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x265a;</span> <a href="CQL-Position-List.html#position:check">:check</a>)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span> <a href="CQL-Position-List.html#position:moveto">:moveto</a> .)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x265a;</span> <a href="CQL-Position-List.html#position:check">:check</a>))))<!--
--></code></pre></div>

<div class='box'><pre><code><!--
--><span class='comment'>; Smothered Mate</span>

<span class='comment'>; A smothered mate is a checkmate delivered by a knight</span>
<span class='comment'>; in which the mated king is unable to move because he is</span>
<span class='comment'>; surrounded (or smothered) by his own pieces.</span>

(match
  (position
    <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>            <span class='comment'>; either color</span>
    <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> k [A.] 0 <span class='comment'>; king is smothered by own pieces</span>
    <a href="CQL-Position-List.html#position:mate">:mate</a>))               <span class='comment'>; and is mate</span><!--
--></code></pre></div>

</body>
</html>
