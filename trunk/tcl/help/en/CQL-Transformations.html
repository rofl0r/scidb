<?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated from tcl/help/en/CQL-Transformations.txt -->

<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<head>
  <meta http-equiv="content-type"
           content="text/html; charset=utf-8" />
  <meta http-equiv="content-language"
           content="en" />
  <meta http-equiv="content-style-type"
           content="text/css" />

  <meta name="generator"
     content="scidb.sourceforge.net" />
  <meta name="description"
     content="Scidb Help Page" />

  <link rel="icon"
       href="http://scidb.sourceforge.net/images/scidb.ico"
       type="image/x-icon" />
  <link rel="shortcut icon"
       href="http://scidb.sourceforge.net/images/scidb.ico" />
  <link rel="stylesheet"
       type="text/css"
      media="screen"
       href="../styles/help.css" />

  <title>Help: CQL - Transformations</title>
</head>

<body>

<div class="title">
  <h1 class="title">CQL - Transformations</h1>
</div>

<ul>
  <li><a href="#tranforms">Transformation keywords in a position list</a></li>
  <li><a href="#examples">Examples of transformation keyword uses</a></li>
  <li><a href="#multiple">Multiple transformation keywords</a></li>
</ul>

<h2 id="tranforms">Transformation keywords in a position list</h2>

<p>
Certain keywords within a position list specify that the position list should
match a position if some transformation of the position list matches the
position. For example, the <a href="CQL-Position-List.html#position:fliphorizontal">:fliphorizontal</a> keyword
specifies that the position list matches a position if either the original
position list matches the position, or if the position list, when flipped
about the horizontal bisector, matches the position.
</p>

<p>
To apply a transformation to a position list we apply the transformation to
each piece designator that occurs in the position, and we recursively apply
the transformation to any other position lists contained in that position
list. If the transformation is a color flip translation, then we also flip
interchange any <a href="CQL-Position-List.html#position:btm">:btm</a> keywords with <a href="CQL-Position-List.html#position:wtm">:wtm</a>
ones, and we flip the <a href="CQL-Position-List.html#position:result">:result</a> keyword arguments
appropriately.
</p>

<p>
For example, consider the position list
</p>

<div class="verb"><code>
(position Rc2 Bh8 :wtm)
</code></div>

<p>
This matches any position with white to move that has a white rook on c2 and a
white bishop on h8. The result of applying a unit left shift transformation to
this position list is the new position list:
</p>

<div class="verb"><code>
(position Rb2 Bg8 :wtm)
</code></div>

<p>
that matches any position with white rook on b2 and white bishop on g8 with
white to move.
</p>

<p>
Similarly, the result of applying a horizontal flip to this position list is
the position list:
</p>

<div class="verb"><code>
(position Rb8 Bg1 :wtm)
</code></div>

<p>
The result of applying a color flip transformation to the
</p>

<div class="verb"><code>
(position Rb2 Bg8 :wtm)
</code></div>

<p>
is thus
</p>

<div class="verb"><code>
(position Rb8 Bg1 :btm)
</code></div>

<p>
Remember that shifts interact specially with certain squares on the edge.
For example the result of applying a unit up shift to this position list:
</p>

<div class="verb"><code>
(position R[a1,a8,h1,a8])
</code></div>

<p>
is the position list:
</p>

<div class="verb"><code>
(position R[a1,a2,h1,h2])
</code></div>

<p>
A transformation set is any set of transformations. A transformation set
applied to a position list is the set of all position lists that result from
applying any transformation in the transformation set to the position list.
</p>

<p>
Each transformation keyword is associated to a transformation set, each of which
also includes the identity transformation.
</p>

<p>
For the transformation keywords see:
<a href="CQL-Position-List.html#transform">The position list: transformation keywords</a>
</p>

<h2 id="examples">Examples of transformation keyword uses</h2>

<div class="verb"><code>
(position Rc3 qg3)
</code></div>

<p>
This position list matches any position with a white rook on c3 and a black
queen on g3. We can add a :shifthorizontal keyword:
</p>

<div class="verb"><code>
(position Rc3 qg3 :shifthorizontal)
</code></div>

<p>
The set of transformed position lists is:
</p>

<div class="verb"><code>
(position Rc3 qg3)<br/>
(position Rb3 qf3)<br/>
(position Ra3 qe3)<br/>
(position Rd3 qh3)
</code></div>

<p>
A position will match the new position list, if there is a white rook and
black queen on the third rank and the white rook is four squares to the left
of the black queen.
</p>

<div class="verb"><code>
(position Rc3 qg3 :shiftvertical)
</code></div>

<p>
Similarly, this position list will match any position in which there is a
white rook on the same rank as a black queen such that the rook is on the c
file and the queen on the g file.
</p>

<div class="verb"><code>
(position Rc3 qg3 :shift)
</code></div>

<p>
This position list will match any position with a white rook and a black
queen on the same rank, in which the white rook is four squares to the left
of the black queen.
</p>

<div class="verb"><code>
(position Rc3 qg3 :fliphorizontal)
</code></div>

<p>
This position list will match any position in which either the white rook
is on c3 and the black queen is on g3, or the white rook is on c6 and the
black queen on g6.
</p>

<div class="verb"><code>
(position Rc3 qg3 :flipdiagonal)
</code></div>

<p>
This position list will match a position in which either a white rook is on
c3 and a black queen on g3, or in which a white rook is on c3 and a black
queen is on c7.
</p>

<div class="verb"><code>
(position Rc3 qg3 :flip)
</code></div>

<p>
The following position list matches any position in which a white rook is
somewhere behind a white pawn on the c file:
</p>

<div class="verb"><code>
(position Pc2 Rc1 :shiftvertical)
</code></div>

<p>
Because of the way edge squares are treated, this will match a position in
which, say, the white rook is on c2 and the white pawn on c7.
</p>

<p>
To match any position in which a white rook is behind a white pawn on the
same file, use:
</p>

<div class="verb"><code>
(position Pc2 Rc1 :shift)
</code></div>

<h2 id="multiple">Multiple transformation keywords</h2>

<p>
When multiple transformation keywords occur, the associated transformation
set is any transformation that can be expressed as a composition of
transformations from the corresponding transformation sets. This feature
is most often used when looking for a piece configuration that can occur
anywhere on the board, possibly rotated or reflected: adding
<span style="white-space:nowrap;"><code>:shift</code></span> <span style="white-space:nowrap;"><code>:flip</code></span> to the position specifier does this.
</p>

<p>
For example, this position list
</p>

<div class="verb"><code>
(position Nd4 kf3 :shift :flip)
</code></div>

<p>
matches any position in which a white knight attacks a black king, while
</p>

<div class="verb"><code>
(position Nd4 kf3 :shift :flip :flipcolor)
</code></div>

<p>
matches any position in which a knight attacks a king of the opposite color.
</p>

<p>
Note: This example can be written much more efficiently as
</p>

<div class="verb"><code>
(position :attackcount N k 1 100 :flipcolor)
</code></div>

<p>
however.
</p>

</body>
</html>
