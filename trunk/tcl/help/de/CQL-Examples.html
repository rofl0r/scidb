<?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated from tcl/help/de/CQL-Examples.txt -->

<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='de'>
<head>
  <meta http-equiv="content-type"
           content="text/html; charset=utf-8" />
  <meta http-equiv="content-language"
           content="de" />
  <meta http-equiv="content-style-type"
           content="text/css" />

  <meta name="author"
     content="scidb.sourceforge.net" />
  <meta name="generator"
     content="scidb.sourceforge.net" />
  <meta name="description"
     content="Scidb Help Page" />

  <link rel="icon"
       href="http://scidb.sourceforge.net/images/scidb.ico"
       type="image/x-icon" />
  <link rel="shortcut icon"
       href="http://scidb.sourceforge.net/images/scidb.ico" />
  <link rel="stylesheet"
       type="text/css"
      media="screen"
       href="../styles/help.css" />

  <title>Scidb Hilfe: CQL - Beispiele</title>
</head>

<body>

<div class="title">
  <h1 class="title">CQL - Beispiele</h1>
</div>

<ul>
  <li><a href="#accumulator">Benutzung von Akkumulatoren zur Zählung von Freibauern</a></li>
  <li><a href="#relation">Beispiele zur Relationenliste</a></li>
  <li><a href="#tagging">Beispiele für Markierungen</a></li>
  <li><a href="#more">Noch mehr Beispiele</a></li>
</ul>

<h2 id="accumulator">Benutzung von Akkumulatoren zur Zählung von Freibauern</h2>

<p>
Wir werden zeigen wie <a href="CQL-Position-List.html#position:accumulate">:accumulate</a> und
<a href="CQL-Position-List.html#position:sumrange">:sumrange</a> zu verwenden sind, um nach Partien
mit mindestens 3 weißen Freibauern in einer Position zu suchen.
Zuerst schreiben wir einen Positionsfilter, der jede Position
findet mit einem weißen Freibauern:
</p>

<div class='box'><pre><code><!--
--><span class='comment'>; finde eine Position mit einem weißen Freibauern</span>
(position
  <span class='piece'>&#x2659;</span>d2
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x265f;</span><span class='piece'>&#x2659;</span>][d3-7] 0
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x265f;</span>[c3-7,e3-7] 0
  <a href="CQL-Position-List.html#position:shift">:shift</a>)<!--
--></code></pre></div>

<p>
Um mindestens 3 weiße Feibauern zu finden fügen wir die Akkumulation hinzu:
</p>

<div class='box'><pre><code><!--
--><span class='comment'>; finde eine Position mit mindestens drei weißen Freibauern</span>
(position
  <span class='piece'>&#x2659;</span>d2
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x265f;</span><span class='piece'>&#x2659;</span>][d3-7] 0
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x265f;</span>[c3-7,e3-7] 0
  <a href="CQL-Position-List.html#position:shift">:shift</a>
  <a href="CQL-Position-List.html#position:accumulate">:accumulate</a> weisse_freibauern_zaehler
  <a href="CQL-Position-List.html#position:sumrange">:sumrange</a> weisse_freibauern_zaehler 3 8)<!--
--></code></pre></div>

<p>
Nun wollen wir Positionen finden mit mindestens zwei schwarzen Freibauern:
</p>

<div class='box'><pre><code><!--
--><span class='comment'>;finde eine Position mit mindestens zwei schwarzen Freibauern</span>
(position
  <span class='piece'>&#x265f;</span>d7 
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x265f;</span><span class='piece'>&#x2659;</span>][d2-6] 0
  <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x2659;</span>[c2-6,e2-6] 0
  <a href="CQL-Position-List.html#position:shift">:shift</a>
  <a href="CQL-Position-List.html#position:accumulate">:accumulate</a> schwarze_freibauern_zaehler
  <a href="CQL-Position-List.html#position:sumrange">:sumrange</a> schwarze_freibauern_zaehler 2 8)<!--
--></code></pre></div>

<p>
Letzendlich kombinieren wir diese Listen, um Positionen mit mindestens zwei
schwarzen und drei weißen Freibauern zu finden:
</p>

<div class='box'><pre><code><!--
--><span class='comment'>; finde eine Position mit mindestens drei</span>
<span class='comment'>; weissen und zwei schwarzen Freibauern</span>
(position
  <a href="CQL-Position-List.html#position:sumrange">:sumrange</a> weisse_freibauern_zaehler 3 8 
  <a href="CQL-Position-List.html#position:sumrange">:sumrange</a> schwarze_freibauern_zaehler 2 8
  <a href="CQL-Position-List.html#position:and">:and</a> (
    (position
      <span class='piece'>&#x2659;</span>d2 
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x265f;</span><span class='piece'>&#x2659;</span>][d3-7] 0
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x265f;</span>[c3-7,e3-7] 0
      <a href="CQL-Position-List.html#position:shift">:shift</a>
      <a href="CQL-Position-List.html#position:accumulate">:accumulate</a> weisse_freibauern_zaehler)
    (position
      <span class='piece'>&#x265f;</span>d7 
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> [<span class='piece'>&#x265f;</span><span class='piece'>&#x2659;</span>][d2-6] 0
      <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x2659;</span>[c2-6,e2-6] 0
      <a href="CQL-Position-List.html#position:shift">:shift</a>
      <a href="CQL-Position-List.html#position:accumulate">:accumulate</a> schwarze_freibauern_zaehler)))<!--
--></code></pre></div>

<h2 id="relation">Beispiele zur Relationenliste</h2>

<p>
Die folgende Positionsliste sucht nach Partien, in denen die Anordnung
</p>

<ul style='list-style-type: none'><li><code>
<span class='piece'>&#x2654;</span>e6 <span class='piece'>&#x265d;</span>e7 <span class='piece'>&#x265d;</span>e4 <span class='piece'>&#x265e;</span>d5
</code></li></ul>

<p>
versetzt oder gespiegelt enthalten ist, aber keine der Figuren der
Originalanordnung auf denselben Feldern steht:
</p>

<div class='box'><pre><code><!--
-->(position
  <span class='piece'>&#x2654;</span>e6 <span class='piece'>&#x265d;</span>e7 <span class='piece'>&#x265d;</span>e4 <span class='piece'>&#x265e;</span>d5
  <a href="CQL-Position-List.html#position:shift">:shift</a>
  <a href="CQL-Position-List.html#position:flip">:flip</a>
  <a href="CQL-Position-List.html#position:relation">:relation</a> (
    <a href="CQL-Relation-List.html#relation:pattern">:pattern</a>
    <a href="CQL-Relation-List.html#relation:shift">:shift</a>
    <a href="CQL-Relation-List.html#relation:flip">:flip</a>
    <a href="CQL-Relation-List.html#relation:originalsamecount">:originalsamecount</a> 0
    <a href="CQL-Relation-List.html#relation:samesidetomove">:samesidetomove</a>
    <a href="CQL-Relation-List.html#relation:variations">:variations</a>))<!--
--></code></pre></div>

<p>
Wird der Parameter für <a href="CQL-Relation-List.html#relation:originalsamecount">:originalsamecount</a> verändert,
beispielsweise vom derzeitigen Wert <span style='white-space:nowrap;'><code>0</code></span> auf den Bereich
<span style='white-space:nowrap;'><code>0 3</code></span>, dann wäre eine Überlappung mit bis zu drei Feldern der
Originalanordnung erlaubt.
</p>

<h2 id="tagging">Beispiele für Markierungen</h2>

<p>
Wir untersuchen das Problem, alle Partien zu erkennen, in denen der gleiche Turm
alle vier Ecken des Bretts besucht:
</p>

<div class='box'><pre><code><!--
-->(match
  <a href="CQL-Match-List.html#match:forany">:forany</a> turm [<span class='piece'>&#x265c;</span><span class='piece'>&#x2656;</span>] <span class='comment'>; über alle Türme iterieren</span>
  (position $turm[a1]) 
  (position $turm[h1])
  (position $turm[h8])
  (position $turm[a8]))<!--
--></code></pre></div>

<p>
In diesem Beipiel definiert das Schlüsselwort <a href="CQL-Position-List.html#position:forany">:forany</a> eine
Markierung mit dem Namen "turm", die an weiße oder schwarze Türme gebunden wird,
(die auch aus einer Bauernumwandlung enstanden sein konnten).
</p>

<p>
Die erste Positionsliste findet Partien in denen eine Position vorliegt, in der
die Merkierung "turm" einen Turm auf a1 repräsentiert. Die nächste Positionsliste
findet Partien in denen eine Position vorliegt, in der die Merkierung "turm"
einen Turm auf h1 repräsentiert. Die Markierung repräsentiert die gleiche Figur
zwischen den Positionslisten. Das Schlüsselwort <a href="CQL-Position-List.html#position:forany">:forany</a>
bindet nacheinander die Markierung an alle erlaubten Figuren.
</p>

<p>
Da eine Suchliste nur dann Partien filtert, wenn jeder einzelne Positionsfilter
diese Partien gefiltert hat, findet dieses Skript was wir suchen.
</p>

<p>
Zweites Beispiel, das Excelsior-Thema: ein Bauer startet auf der zweiten Reihe
und verwandelt sich dann.
</p>

<div class='box'><pre><code><!--
-->(match
  <a href="CQL-Match-List.html#match:forany">:forany</a> bauer [<span class='piece'>&#x2659;</span><span class='piece'>&#x265f;</span>]
  (position
    <a href="CQL-Position-List.html#position:initial">:initial</a>
    <a href="CQL-Position-List.html#position:tagmatch">:tagmatch</a> bauer <span class='piece'>&#x2659;</span>?2
    <a href="CQL-Position-List.html#position:gappedsequence">:gappedsequence</a> ((position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> $bauer <a href="CQL-Position-List.html#position:promote">:promote</a> U))
    <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>))<!--
--></code></pre></div>

<p>
<a href="CQL-Position-List.html#position:tagmatch">:tagmatch</a> findet Bauern auf der zweiten Reihe, und die
mit <a href="CQL-Position-List.html#position:gappedsequence">:gappedsequence</a> definierte Positionsreihe ist
erfolgreich, wenn die Markierung "bauer" in irgendeiner nachfolgenden
Position verwandelt.
</p>

<p>
Drittes Beispiel: die gleiche Figur bietet mindestens 30 mal Schach in einer
Partie.
</p>

<div class='box'><pre><code><!--
-->(match
  <a href="CQL-Match-List.html#match:forany">:forany</a> schachgeber A
  (position
    <a href="CQL-Position-List.html#position:btm">:btm</a>
    <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> $schachgeber <span class='piece'>&#x265a;</span> 1
    <a href="CQL-Position-List.html#position:matchcount">:matchcount</a> 30 unlimited
    <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>))<!--
--></code></pre></div>

<p>
Viertes Beispiel: ein Springer gibt Matt mit seinem ersten Zug.
</p>

<div class='box'><pre><code><!--
-->(match
  <a href="CQL-Match-List.html#match:forany">:forany</a> springer <span class='piece'>&#x2658;</span>
  (position
    <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> $springer
    <a href="CQL-Position-List.html#position:matchcount">:matchcount</a> 1)
  (position
    <a href="CQL-Position-List.html#position:mate">:mate</a>
    <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> $springer <span class='piece'>&#x265a;</span> 1)) <!--
--></code></pre></div>

<h2 id="more">Noch mehr Beispiele</h2>

<div class='box'><pre><code><!--
--><span class='comment'>; Finde isolierte Triplebauern auf verbundenen Feldern</span>
<span class='comment'>; Beispiel: 8/p4pk1/8/2R1P1N1/6P1/6P1/2P2KP1/1r5r w - - 0 1</span>

(match
  (position
    <span class='piece'>&#x2659;</span>[b2-4]
    [.a<span class='piece'>&#x2654;</span><span class='piece'>&#x2655;</span><span class='piece'>&#x2656;</span><span class='piece'>&#x2657;</span><span class='piece'>&#x2658;</span>][a1-8]
    [.a<span class='piece'>&#x2654;</span><span class='piece'>&#x2655;</span><span class='piece'>&#x2656;</span><span class='piece'>&#x2657;</span><span class='piece'>&#x2658;</span>][c1-8]
    <a href="CQL-Position-List.html#position:piececount">:piececount</a> <span class='piece'>&#x2659;</span>b? 3 6
    <a href="CQL-Position-List.html#position:shiftvertical">:shiftvertical</a>
    <a href="CQL-Position-List.html#position:shifthorizontal">:shifthorizontal</a>
    <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>))<!--
--></code></pre></div>

<div class='box'><pre><code><!--
--><span class='comment'>; Mehrere aufeinanderfolgende Turmschachgebote jeweils gefolgt von</span>
<span class='comment'>; einem Königszug auf ein freies Feld; normalerweise um Patt zu</span>
<span class='comment'>; vermeiden wenn der Turm geschlagen wird.</span>

(match
  <a href="CQL-Match-List.html#match:result">:result</a> 1/2
  (position 
    <a href="CQL-Position-List.html#position:wtm">:wtm</a>
    <a href="CQL-Position-List.html#position:sequence">:sequence</a> (  
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span> <a href="CQL-Position-List.html#position:moveto">:moveto</a> .)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x265a;</span> <a href="CQL-Position-List.html#position:check">:check</a>)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span> <a href="CQL-Position-List.html#position:moveto">:moveto</a> .)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x265a;</span> <a href="CQL-Position-List.html#position:check">:check</a>)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span> <a href="CQL-Position-List.html#position:moveto">:moveto</a> .)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x265a;</span> <a href="CQL-Position-List.html#position:check">:check</a>)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span> <a href="CQL-Position-List.html#position:moveto">:moveto</a> .)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x265a;</span> <a href="CQL-Position-List.html#position:check">:check</a>)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x2656;</span> <a href="CQL-Position-List.html#position:moveto">:moveto</a> .)
      (position <a href="CQL-Position-List.html#position:movefrom">:movefrom</a> <span class='piece'>&#x265a;</span> <a href="CQL-Position-List.html#position:check">:check</a>))))<!--
--></code></pre></div>

<div class='box'><pre><code><!--
--><span class='comment'>; Ersticktes Matt</span>

<span class='comment'>; Ein ersticktes Matt liegt vor, wenn ein Springer Matt</span>
<span class='comment'>; setzt und der König nicht entweichen kann, weil er</span>
<span class='comment'>; von eigenen Figuren umgeben (erstickt) ist.</span>

(match
  (position
    <a href="CQL-Position-List.html#position:flipcolor">:flipcolor</a>            ; Jede Farbe
    <a href="CQL-Position-List.html#position:attackcount">:attackcount</a> k [A.] 0 ; König ist von eigenen Figuren umzingelt
    <a href="CQL-Position-List.html#position:mate">:mate</a>))               ; und ist matt<!--
--></code></pre></div>

</body>
</html>
